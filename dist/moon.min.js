/*
* Moon 0.1.3
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){"use strict";function t(o){this.$opts=o||{};var i=this,s=this.$opts.data;this.$id=r++,this.$render=this.$opts.render||d,this.$hooks=l({created:d,mounted:d,updated:d,destroyed:d},this.$opts.hooks),this.$methods=this.$opts.methods||{},this.$components=l(this.$opts.components||{},n),this.$directives=l(this.$opts.directives||{},e),this.$events={},this.$dom={},this.$destroyed=!1,this.$queued=!1,Object.defineProperty(this,"$data",{get:function(){return s},set:function(t){s=t,this.build(this.$dom.children)},configurable:!0}),e[t.config.prefix+"if"]={beforeGenerate:function(t,e,n){return"("+u(t)+") ? "+e+" : ''"}},e[t.config.prefix+"show"]=function(t,e,n){var r=new Function("return "+e);r()?t.style.display="block":t.style.display="none"},e[t.config.prefix+"on"]=function(e,n,r){var o=n.split(":"),s=o[0],u=o[1];i.$events[s]?i.on(s,u):e.addEventListener(s,function(t){i.callMethod(u,[t])}),delete r.props[t.config.prefix+"on"]},e[t.config.prefix+"model"]=function(e,n,r){e.value=i.get(n),e.addEventListener("input",function(){i.set(n,e.value)}),delete r.props[t.config.prefix+"model"]},e[t.config.prefix+"for"]=function(t,e,n){var r=e.split(" in ");r[0],i.get(r[1])},e[t.config.prefix+"once"]=function(t,e,n){n.meta.shouldRender=!1},e[t.config.prefix+"text"]=function(t,e,n){t.textContent=e},e[t.config.prefix+"html"]=function(t,e,n){t.innerHTML=e},e[t.config.prefix+"mask"]=function(t,e,n){},this.init()}var e={},n={},r=0,o=function(e){t.config.silent||console.log(e)},i=function(t){console.error("[Moon] ERR: "+t)},s=function(t){var e={};if(!t.attributes)return e;for(var n=t.attributes,r=0;r<n.length;r++)e[n[r].name]=n[r].value;return e},u=function(t,e){var n=/{{([A-Za-z0-9_.()\[\]]+)}}/gi,r=t;return t.replace(n,function(n,o){r=e?t.replace(n,'" + this.get("'+o+'") + "'):t.replace(n,'this.get("'+o+'")')}),r},c=function(t,e,n,r,o){return{type:t,val:e,props:n,children:r,meta:o||{shouldRender:!0}}},p=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift()||{},r=t;return c(e,r.join(""),n,r,null)},a=function(t){var e;if("string"==typeof t)e=document.createTextNode(t);else{e=document.createElement(t.type);for(var n=t.children.map(a),r=0;r<n.length;r++)e.appendChild(n[r])}return e},h=function(t,n,r){var o=l(n,r);for(var i in o)!r[i]||e[i]?t.removeAttribute(i):n[i]&&n[i]===r[i]||t.setAttribute(i,r[i])},f=function(t,n,r){var o;if(t&&(o=t.nodeName.toLowerCase()),null===n&&(n=""),t)if(n){if(o!==(n.type||"#text"))r.replaceChild(a(n),t);else if("#text"===o&&"string"==typeof n)t.textContent=n;else if(n.type){var i=s(t);h(t,i,n.props),i=s(t);for(var u in i)e[u]&&e[u](t,i[u],n);for(var c=0;c<n.children.length||c<t.childNodes.length;c++)f(t.childNodes[c],n.children[c],t)}}else r.removeChild(t);else r.appendChild(a(n))},l=function(t,e){var n=Object.create(t);for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},d=function(){},v=function(t,e){var n={input:t,current:0,tokens:[]};return y(n),n.tokens},y=function(t){for(var e=t.input,n=e.length;t.current<n;)"<"===e.charAt(t.current)?"<!--"!==e.substr(t.current,4)?m(t):g(t):$(t)},$=function(t){var e=t.input,n=e.length,r=e.indexOf("<",t.current);return r===-1?(t.tokens.push({type:"text",value:e.slice(t.current)}),void(t.current=n)):void(r!==t.current&&(t.tokens.push({type:"text",value:e.slice(t.current,r)}),t.current=r))},g=function(t){var e=t.input,n=e.length;t.current+=4;var r=e.indexOf("-->",t.current);return r===-1?(t.tokens.push({type:"comment",value:e.slice(t.current)}),void(t.current=n)):(t.tokens.push({type:"comment",value:e.slice(t.current,r)}),void(t.current=r+3))},m=function(t){var e=t.input,n=(e.length,"/"===e.charAt(t.current+1));e.charAt(t.currrent);t.tokens.push({type:"tagStart",close:n}),t.current+=n?2:1;var r=k(t);x(t);var o="/"===e.charAt(t.current);t.tokens.push({type:"tagEnd",close:!1}),t.current+=o?2:1,o&&(t.tokens.push({type:"tagStart",close:!0}),t.tokens.push({type:"tag",value:r}),t.tokens.push({type:"attribute",value:{}}),t.tokens.push({type:"tagEnd",close:!1}))},k=function(t){for(var e=t.input,n=e.length,r=t.current;r<n;){var o=e.charAt(r);if("/"!==o&&">"!==o&&" "!==o)break;r++}for(var i=r;i<n;){var o=e.charAt(i);if("/"===o||">"===o||" "===o)break;i++}var s=e.slice(r,i);return t.tokens.push({type:"tag",value:s}),t.current=i,s},x=function(t){for(var e=t.input,n=e.length,r=t.current,o={},i="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var u=e.charAt(r);if(">"===u||"/"===u)break;i+=u,r++}i.replace(s,function(t,e,n,r){var i=r[0],s=r[r.length-1];("'"===i&&"'"===s||'"'===i&&'"'===s)&&(r=r.slice(1,-1)),r||(r=e),e&&r&&(o[e]=r)}),t.current=r,t.tokens.push({type:"attribute",value:o})},b=function(t){for(var e={type:"ROOT",children:[]},n={current:0,tokens:t};n.current<t.length;){var r=O(n);r&&e.children.push(r)}return e},A=function(t,e,n){return{type:t,props:e,children:n}},O=function(t){var e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2],i=t.tokens[t.current+3],s=function(i){t.current+=void 0===i?1:i,e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2]};if("text"===e.type)return s(),n.value;if("comment"===e.type)return void s();if("tag"===e.type&&!n.close&&!o.close){var u=A(e.value,r.value,[]),c=e.value;s(3);var p=t.current;if(e)for(;"tag"!==e.type||"tag"===e.type&&e.value!==c&&(!n.close||!o.close);){if("tagStart"===e.type&&r.value!==c&&(e.close||i.close)){t.current=p,u.children=[],s(0);break}var a=O(t);a&&u.children.push(a),s(0)}return u}s()},E=function(t){var n="";if("string"==typeof t)n+='"'+t+'"';else{t.children=t.children.map(E);var r='h("'+t.type+'", '+JSON.stringify(t.props)+", "+(t.children.join(",")||null)+")";for(var o in t.props)e[o]&&e[o].beforeGenerate&&(r=e[o].beforeGenerate(t.props[o],r,t));n+=r}return n},C=function(t){var e=/\n/g,n=t.children[0],r="return "+E(n);r=u(r,!0),r=r.replace(e,'" + "\\n" + "');try{return new Function("h",r)}catch(t){return i("Could not create render function"),d}},j=function(t){var e=v(t),n=b(e);return C(n)};return t.prototype.get=function(t){return this.$data[t]},t.prototype.set=function(t,e){var n=this;this.$data[t]=e,this.$queued||this.$destroyed||(this.$queued=!0,setTimeout(function(){n.build(),n.$hooks.updated(),n.$queued=!1},0))},t.prototype.destroy=function(){Object.defineProperty(this,"$data",{set:function(t){_data=t}}),this.removeEvents(),this.$destroyed=!0,this.$hooks.destroyed()},t.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},t.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},t.prototype.off=function(t,e){var n=this.$events[t].indexOf(e);n!==-1&&this.$events[t].splice(n,1)},t.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},t.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(e)}for(var n=0;n<this.$events[t].length;n++){var o=this.$events[t][n];o(e)}},t.prototype.mount=function(e){this.$el=document.querySelector(e),this.$el||i("Element "+this.$opts.el+" not found"),this.$template=this.$opts.template||this.$el.outerHTML,this.$render===d&&(this.$render=t.compile(this.$template)),this.build(),this.$hooks.mounted()},t.prototype.render=function(){return this.$render(p)},t.prototype.patch=function(t,e,n){f(t,e,n)},t.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom,this.$el.parentNode)},t.prototype.init=function(){o("======= Moon ======="),this.$hooks.created(),this.$opts.el&&this.mount(this.$opts.el)},t.config={silent:!1,prefix:"m-"},t.use=function(e){e.init(t)},t.compile=function(t){return j(t)},t.nextTick=function(t){setTimeout(t,0)},t.directive=function(n,r){e[t.config.prefix+n]=r},t.component=function(e,r){function o(){t.call(this,r)}var i=this;o.prototype=Object.create(i.prototype),o.prototype.constructor=o;var s=new o;return n[e]=s,s},t});