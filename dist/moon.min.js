/*
* Moon 0.1.3
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){"use strict";function t(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function e(i){this.$opts=i||{};var s=this,u=this.$opts.data;this.$id=o++,this.$render=this.$opts.render||h,this.$hooks=t({created:h,mounted:h,updated:h,destroyed:h},this.$opts.hooks),this.$methods=this.$opts.methods||{},this.$components=t(this.$opts.components||{},r),this.$directives=t(this.$opts.directives||{},n),this.$events={},this.$dom={},this.$destroyed=!1,Object.defineProperty(this,"$data",{get:function(){return u},set:function(t){u=t,this.build(this.$dom.children)},configurable:!0}),n[e.config.prefix+"if"]=function(t,e,n){var r=new Function("return "+e);if(r())for(var o=0;o<n.children.length;o++)n.children[o].meta.shouldRender=!0;else for(var o=0;o<n.children.length;o++)n.children[o].node.textContent="",n.children[o].meta.shouldRender=!1},n[e.config.prefix+"show"]=function(t,e,n){var r=new Function("return "+e);r()?t.style.display="block":t.style.display="none"},n[e.config.prefix+"on"]=function(t,n,r){var o=n.split(":"),i=o[0],u=o[1];s.$events[i]?s.on(i,u):t.addEventListener(i,function(t){s.callMethod(u,[t])}),delete r.props[e.config.prefix+"on"]},n[e.config.prefix+"model"]=function(t,n,r){t.value=s.get(n),t.addEventListener("input",function(){s.set(n,t.value)}),delete r.props[e.config.prefix+"model"]},n[e.config.prefix+"for"]=function(t,e,n){var r=e.split(" in ");r[0],s.get(r[1])},n[e.config.prefix+"once"]=function(t,e,n){n.meta.shouldRender=!1},n[e.config.prefix+"text"]=function(t,e,n){t.textContent=e},n[e.config.prefix+"html"]=function(t,e,n){t.innerHTML=e},n[e.config.prefix+"mask"]=function(t,e,n){},this.init()}var n={},r={},o=0,i=function(t){e.config.silent||console.log(t)},s=function(t){console.error("[Moon] ERR: "+t)},u=function(t,e,n,r,o){return{type:t,val:e,props:n,children:r,meta:o||{shouldRender:!0}}},c=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift()||{},r=t;return"string"==typeof r[0]&&(r[0]=u("#text",r[0],{},[],null)),u(e,r.join(""),n,r,null)},h=function(){},p=function(t,e){var n={input:t,current:0,tokens:[]};return a(n),n.tokens},a=function(t){for(var e=t.input,n=e.length;t.current<n;)"<"===e.charAt(t.current)?"<!--"!==e.substr(t.current,4)?d(t):f(t):l(t)},l=function(t){var e=t.input,n=e.length,r=e.indexOf("<",t.current);return r===-1?(t.tokens.push({type:"text",value:e.slice(t.current)}),void(t.current=n)):void(r!==t.current&&(t.tokens.push({type:"text",value:e.slice(t.current,r)}),t.current=r))},f=function(t){var e=t.input,n=e.length;t.current+=4;var r=e.indexOf("-->",t.current);return r===-1?(t.tokens.push({type:"comment",value:e.slice(t.current)}),void(t.current=n)):(t.tokens.push({type:"comment",value:e.slice(t.current,r)}),void(t.current=r+3))},d=function(t){var e=t.input,n=(e.length,"/"===e.charAt(t.current+1));e.charAt(t.currrent);t.tokens.push({type:"tagStart",close:n}),t.current+=n?2:1;var r=v(t);y(t);var o="/"===e.charAt(t.current);t.tokens.push({type:"tagEnd",close:!1}),t.current+=o?2:1,o&&(t.tokens.push({type:"tagStart",close:!0}),t.tokens.push({type:"tag",value:r}),t.tokens.push({type:"attribute",value:{}}),t.tokens.push({type:"tagEnd",close:!1}))},v=function(t){for(var e=t.input,n=e.length,r=t.current;r<n;){var o=e.charAt(r);if("/"!==o&&">"!==o&&" "!==o)break;r++}for(var i=r;i<n;){var o=e.charAt(i);if("/"===o||">"===o||" "===o)break;i++}var s=e.slice(r,i);return t.tokens.push({type:"tag",value:s}),t.current=i,s},y=function(t){for(var e=t.input,n=e.length,r=t.current,o={},i="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var u=e.charAt(r);if(">"===u||"/"===u)break;i+=u,r++}i.replace(s,function(t,e,n,r){var i=r[0],s=r[r.length-1];("'"===i&&"'"===s||'"'===i&&'"'===s)&&(r=r.slice(1,-1)),r||(r=e),e&&r&&(o[e]=r)}),t.current=r,t.tokens.push({type:"attribute",value:o})},$=function(t){for(var e={type:"ROOT",children:[]},n={current:0,tokens:t};n.current<t.length;){var r=m(n);r&&e.children.push(r)}return e},g=function(t,e,n){return{type:t,props:e,children:n}},m=function(t){var e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2],i=t.tokens[t.current+3],s=function(i){t.current+=void 0===i?1:i,e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2]};if("text"===e.type)return s(),n.value;if("comment"===e.type)return void s();if("tag"===e.type&&!n.close&&!o.close){var u=g(e.value,r.value,[]),c=e.value;s(3);var h=t.current;if(e)for(;"tag"!==e.type||"tag"===e.type&&e.value!==c&&(!n.close||!o.close);){if("tagStart"===e.type&&r.value!==c&&(e.close||i.close)){t.current=h,u.children=[],s(0);break}var p=m(t);p&&u.children.push(p),s(0)}return u}s()},k=function(t){var e="";return"string"==typeof t?e+='"'+t+'"':(t.children=t.children.map(k),e+='h("'+t.type+'", '+JSON.stringify(t.props)+", "+t.children.join(",")+")"),e},x=function(t){var e=/{{([A-Za-z0-9_.()\[\]]+)}}/gi,n=t.children[0],r="return "+k(n);r.replace(e,function(t,e){r=r.replace(t,'" + this.get("'+e+'") + "')});try{return new Function("h",r)}catch(t){return s("Could not create render function"),h}},b=function(t){var e=p(t),n=$(e);return x(n)};return e.prototype.get=function(t){return this.$data[t]},e.prototype.set=function(t,e){this.$data[t]=e,this.$destroyed||this.build(),this.$hooks.updated()},e.prototype.destroy=function(){Object.defineProperty(this,"$data",{set:function(t){_data=t}}),this.removeEvents(),this.$destroyed=!0,this.$hooks.destroyed()},e.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},e.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},e.prototype.off=function(t,e){var n=this.$events[t].indexOf(e);n!==-1&&this.$events[t].splice(n,1)},e.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},e.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(e)}for(var n=0;n<this.$events[t].length;n++){var o=this.$events[t][n];o(e)}},e.prototype.mount=function(t){this.$el=document.querySelector(t),this.$el||s("Element "+this.$opts.el+" not found"),this.$template=this.$opts.template||this.$el.outerHTML,this.$el.outerHTML=this.$template,this.$render===h&&(this.$render=e.compile(this.$template)),this.build(),this.$hooks.mounted()},e.prototype.render=function(){return this.$render(c)},e.prototype.patch=function(t,e){},e.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom)},e.prototype.init=function(){i("======= Moon ======="),this.$hooks.created(),this.$opts.el&&this.mount(this.$opts.el)},e.config={silent:!1,prefix:"m-"},e.use=function(t){t.init(e)},e.directive=function(t,r){n[e.config.prefix+t]=r},e.component=function(t,n){function o(){e.call(this,n)}var i=this;o.prototype=Object.create(i.prototype),o.prototype.constructor=o;var s=new o;return r[t]=s,s},e.compile=function(t){return b(t)},e});