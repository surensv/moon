/*
* Moon 0.0.0
* Copyright 2016, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
"use strict";!function(t){function e(t){var e=t.el,r=t.data,s=t.methods,a={},u=this;this.$el=document.querySelector(e),this.components=t.components,this.dom={type:this.$el.nodeName,children:[],node:this.$el},Object.defineProperty(this,"$data",{get:function(){return r},set:function(t){r=t,this.build(this.dom.children)}}),this.log=function(t){n.silent||console.log(t)},this.error=function(t){console.log("Moon ERR: "+t)},this.createElement=function(t,e,n,i,o){return{type:t,children:e,val:n,props:i,node:o}},this.recursiveChildren=function(t){for(var e=[],n=0;n<t.length;n++){var o=t[n];e.push(this.createElement(o.nodeName,this.recursiveChildren(o.childNodes),o.textContent,i(o),o))}return e},this.createVirtualDOM=function(t){var e=this.createElement(t.nodeName,this.recursiveChildren(t.childNodes),t.textContent,i(t),t);this.dom=e},this.componentsToHTML=function(){for(var t in this.components){var e=document.getElementsByTagName(t);e=Array.prototype.slice.call(e);for(var n=0;n<e.length;n++){var o=e[n],r=i(o),s=document.createElement("div");s.innerHTML=this.components[t].template,s=s.firstChild;for(var a in r)s.setAttribute(a,r[a]);o.outerHTML=s.outerHTML}}},this.set=function(t,e){this.$data[t]=e,this.build(this.dom.children)},this.get=function(t){return this.$data[t]},this.ajax=function(t,e,n,i){var o=new XMLHttpRequest;t=t.toUpperCase(),"function"==typeof n&&(i=n);var r="?";if("POST"===t){http.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var s in n)r+=s+"="+n[s]+"&"}o.onreadystatechange=function(){4==o.readyState&&200==o.status&&i(JSON.parse(o.responseText))},o.open(t,e,!0),o.send("POST"===t?r:null)},this.method=function(t){s[t]()},this.directive=function(t,e){a["m-"+t]=e},a["m-if"]=function(t,e,n){var i=new Function("return "+e);i()?t.textContent=o(n.val,u.$data):t.textContent=""},a["m-on"]=function(t,e,n){var i=e.split(":"),o=i[0],r=i[1];t.addEventListener(o,function(){u.method(r)}),t.removeAttribute("m-on"),delete n.props["m-on"]},a["m-model"]=function(t,e,n){t.value=u.get(e),t.addEventListener("input",function(){u.set(e,t.value)}),t.removeAttribute("m-model"),delete n.props["m-model"]},a["m-once"]=function(t,e,n){n.val=t.textContent;for(var i in n.children)n.children[i].val=o(n.children[i].val,u.$data)},this.build=function(t){for(var e=0;e<t.length;e++){var n=t[e];if("#text"===n.type)n.node.textContent=o(n.val,this.$data);else if(n.props)for(var i in n.props){var r=n.props[i],s=o(r,this.$data),u=a[i];u&&u(n.node,s,n),n.node.setAttribute(i,s)}this.build(n.children)}},this.init=function(){this.log("======= Moon ======="),this.componentsToHTML(),this.createVirtualDOM(this.$el),this.build(this.dom.children)},this.init()}var n={silent:!1},i=function(t){var e={};if(!t.attributes)return e;for(var n=t.attributes,i=0;i<n.length;i++)e[n[i].name]=n[i].value;return e},o=function(t,e){var n=t,i=/{{([A-Za-z0-9_.\[\]]+)}}/gi;n.replace(i,function(t,e){n=n.replace(t,"` + data."+e+" + `")});var o=new Function("data","var out = `"+n+"`; return out");return o(e)};e.config=function(t){t.silent&&(n.silent=t.silent)},e.use=function(t){t.init(e)},t.Moon=e,t.$=function(t){return t=document.querySelectorAll(t),1===t.length?t[0]:t}}(window);