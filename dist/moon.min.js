/*
* Moon 0.1.3
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){function t(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function e(o){this.$opts=o||{};var s=this,c=this.$opts.data;this.$id=i++,this.$render=this.$opts.render||h,this.$hooks=t({created:h,mounted:h,updated:h,destroyed:h},this.$opts.hooks),this.$methods=this.$opts.methods||{},this.$components=t(this.$opts.components||{},r),this.$directives=t(this.$opts.directives||{},n),this.$events={},this.$dom={},this.$destroyed=!1,Object.defineProperty(this,"$data",{get:function(){return c},set:function(t){c=t,this.build(this.$dom.children)},configurable:!0}),n[e.config.prefix+"if"]=function(t,e,n){var r=new Function("return "+e);if(r())for(var i=0;i<n.children.length;i++)n.children[i].meta.shouldRender=!0;else for(var i=0;i<n.children.length;i++)n.children[i].node.textContent="",n.children[i].meta.shouldRender=!1},n[e.config.prefix+"show"]=function(t,e,n){var r=new Function("return "+e);r()?t.style.display="block":t.style.display="none"},n[e.config.prefix+"on"]=function(t,n,r){var i=n.split(":"),o=i[0],c=i[1];s.$events[o]?s.on(o,c):t.addEventListener(o,function(t){s.callMethod(c,[t])}),delete r.props[e.config.prefix+"on"]},n[e.config.prefix+"model"]=function(t,n,r){t.value=s.get(n),t.addEventListener("input",function(){s.set(n,t.value)}),delete r.props[e.config.prefix+"model"]},n[e.config.prefix+"for"]=function(t,e,n){var r=e.split(" in ");r[0],s.get(r[1])},n[e.config.prefix+"once"]=function(t,e,n){n.meta.shouldRender=!1},n[e.config.prefix+"text"]=function(t,e,n){t.textContent=e},n[e.config.prefix+"html"]=function(t,e,n){t.innerHTML=e},n[e.config.prefix+"mask"]=function(t,e,n){},this.init()}var n={},r={},i=0,o=function(t){e.config.silent||console.log(t)},s=function(t){console.error("[Moon] ERR: "+t)},c=function(t,e,n,r,i){return{type:t,val:e,props:n,children:r,meta:i||{shouldRender:!0}}},u=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift()||{},r=t;return"string"==typeof r[0]&&(r[0]=c("#text",r[0],{},[],null)),c(e,r.join(""),n,r,null)},h=function(){},p=function(t,e){var n={input:t,current:0,tokens:[]};return f(n),n.tokens},f=function(t){for(var e=t.input,n=e.length;t.current<n;)"<"===e.charAt(t.current)?"<!--"!==e.substr(t.current,4)?d(t):l(t):a(t)},a=function(t){var e=t.input,n=e.length,r=e.indexOf("<",t.current);return r===-1?(t.tokens.push({type:"text",value:e.slice(t.current)}),void(t.current=n)):void(r!==t.current&&(t.tokens.push({type:"text",value:e.slice(t.current,r)}),t.current=r))},l=function(t){var e=t.input,n=e.length;t.current+=4;var r=e.indexOf("-->",t.current);return r===-1?(t.tokens.push({type:"comment",value:e.slice(t.current)}),void(t.current=n)):(t.tokens.push({type:"comment",value:e.slice(t.current,r)}),void(t.current=r+3))},d=function(t){var e=t.input,n=(e.length,"/"===e.charAt(t.current+1));e.charAt(t.currrent);t.tokens.push({type:"tagStart",close:n}),t.current+=n?2:1,v(t),$(t);var r="/"===e.charAt(t.current);e.charAt(t.current);t.tokens.push({type:"tagEnd",close:r}),t.current+=r?2:1},v=function(t){for(var e=t.input,n=e.length,r=t.current;r<n;){var i=e.charAt(r);if("/"!==i&&">"!==i&&" "!==i)break;r++}for(var o=r;o<n;){var i=e.charAt(o);if("/"===i||">"===i||" "===i)break;o++}var s=e.slice(r,o);t.tokens.push({type:"tag",value:s}),t.current=o},$=function(t){for(var e=t.input,n=e.length,r=t.current,i={},o="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var c=e.charAt(r);if(">"===c||"/"===c)break;o+=c,r++}o.replace(s,function(t,e,n,r){var o=r[0],s=r[r.length-1];("'"===o&&"'"===s||'"'===o&&'"'===s)&&(r=r.slice(1,-1)),r||(r=!0),e&&r&&(i[e]=r)}),t.current=r,t.tokens.push({type:"attribute",value:i})},y=function(t){},m=function(t){for(var e="",n=0;n<t.children.length;n++){var r=t.children[n];r.children&&(r.children=r.children.map(function(t){return m(t)})),e+="string"==typeof r?'h(null, null, "'+r+'")':'h("'+r.type+'", '+JSON.stringify(r.props)+", "+r.children+")"}return e},g=function(t){var e=/{{([A-Za-z0-9_.()\[\]]+)}}/gi,n="return "+m(t);n.replace(e,function(t,e){n=n.replace(t,'" + data["'+e+'"] + "')});try{return new Function("h",n)}catch(t){return s("Could not create render function"),h}},x=function(t){var e=p(t),n=y(e);return g(n)};return e.prototype.get=function(t){return this.$data[t]},e.prototype.set=function(t,e){this.$data[t]=e,this.$destroyed||this.build(),this.$hooks.updated()},e.prototype.destroy=function(){Object.defineProperty(this,"$data",{set:function(t){_data=t}}),this.removeEvents(),this.$destroyed=!0,this.$hooks.destroyed()},e.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},e.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},e.prototype.off=function(t,e){var n=this.$events[t].indexOf(e);n!==-1&&this.$events[t].splice(n,1)},e.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},e.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(e)}for(var n=0;n<this.$events[t].length;n++){var i=this.$events[t][n];i(e)}},e.prototype.mount=function(t){this.$el=document.querySelector(t),this.$el||s("Element "+this.$opts.el+" not found"),this.$template=this.$opts.template||this.$el.innerHTML,this.$el.innerHTML=this.$template,this.$render===h&&(this.$render=e.compile(this.$template)),this.build(),this.$hooks.mounted()},e.prototype.render=function(){return this.$render(u)},e.prototype.patch=function(t,e){},e.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom)},e.prototype.init=function(){o("======= Moon ======="),this.$hooks.created(),this.$opts.el&&this.mount(this.$opts.el)},e.config={silent:!1,prefix:"m-"},e.use=function(t){t.init(e)},e.directive=function(t,r){n[e.config.prefix+t]=r},e.component=function(t,n){function i(){e.call(this,n)}var o=this;i.prototype=Object.create(o.prototype),i.prototype.constructor=i;var s=new i;return r[t]=s,s},e.compile=function(t){return x(t)},e});