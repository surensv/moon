/*
* Moon 0.1.3
* Copyright 2016, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
"use strict";!function(t){function e(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function n(t){var n=t.el,c=t.data,d=t.methods,l=t.hooks||{created:function(){},mounted:function(){},updated:function(){},destroyed:function(){}},h=!1,f=this;this.$el=document.querySelector(n),this.$components=e(t.components||{},r),this.$dom={type:this.$el.nodeName,children:[],node:this.$el},Object.defineProperty(this,"$data",{get:function(){return c},set:function(t){c=t,this.build(this.$dom.children)},configurable:!0}),this.log=function(t){o.silent||console.log(t)},this.error=function(t){console.log("Moon ERR: "+t)},this.createElement=function(t,e,n,o,i){return{type:t,children:e,val:n,props:o,node:i}},this.recursiveChildren=function(t){for(var e=[],n=0;n<t.length;n++){var o=t[n];e.push(this.createElement(o.nodeName,this.recursiveChildren(o.childNodes),o.textContent,s(o),o))}return e},this.createVirtualDOM=function(t){var e=this.createElement(t.nodeName,this.recursiveChildren(t.childNodes),t.textContent,s(t),t);this.$dom=e},this.componentsToHTML=function(){for(var t in this.$components){var e=document.getElementsByTagName(t);e=Array.prototype.slice.call(e);for(var n=0;n<e.length;n++){var o=e[n],i=s(o),r=u(this.$components[t].template);for(var a in i)r.setAttribute(a,i[a]);o.outerHTML=r.outerHTML}}},this.set=function(t,e){this.$data[t]=e,h||this.build(this.$dom.children),l.updated&&l.updated()},this.get=function(t){return this.$data[t]},this.method=function(t){d[t]()},this.destroy=function(){Object.defineProperty(this,"$data",{set:function(t){c=t}}),h=!0,l.destroyed&&l.destroyed()},i["m-if"]=function(t,e,n){var o=new Function("return "+e);o()?t.textContent=a(n.val,f.$data):t.textContent=""},i["m-show"]=function(t,e,n){var o=new Function("return "+e);o()?t.style.display="block":t.style.display="none"},i["m-on"]=function(t,e,n){var o=e.split(":"),i=o[0],r=o[1];t.addEventListener(i,function(){f.method(r)}),t.removeAttribute("m-on"),delete n.props["m-on"]},i["m-model"]=function(t,e,n){t.value=f.get(e),t.addEventListener("input",function(){f.set(e,t.value)}),t.removeAttribute("m-model"),delete n.props["m-model"]},i["m-once"]=function(t,e,n){n.val=t.textContent;for(var o in n.children)n.children[o].val=a(n.children[o].val,f.$data)},i["m-text"]=function(t,e,n){t.textContent=e},i["m-html"]=function(t,e,n){t.innerHTML=e},i["m-mask"]=function(t,e,n){},this.build=function(t){for(var e=0;e<t.length;e++){var n=t[e];if("#text"===n.type)n.node.textContent=a(n.val,this.$data);else if(n.props)for(var o in n.props){var r=n.props[o],s=a(r,this.$data),u=i[o];u&&(n.node.removeAttribute(o),u(n.node,s,n)),u||n.node.setAttribute(o,s)}this.build(n.children)}},this.init=function(){this.log("======= Moon ======="),l.created&&l.created(),this.componentsToHTML(),this.createVirtualDOM(this.$el),this.build(this.$dom.children),l.mounted&&l.mounted()},this.init()}var o={silent:!1},i={},r={},s=function(t){var e={};if(!t.attributes)return e;for(var n=t.attributes,o=0;o<n.length;o++)e[n[o].name]=n[o].value;return e},a=function(t,e){var n=t,o=/{{([A-Za-z0-9_.\[\]]+)}}/gi;n.replace(o,function(t,e){n=n.replace(t,"` + data."+e+" + `")});var i=new Function("data","var out = `"+n+"`; return out"),r=i(e);return r},u=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild};n.config=function(t){t.silent&&(o.silent=t.silent)},n.use=function(t){t.init(n)},n.directive=function(t,e){i["m-"+t]=e},n.component=function(t,e){r[t]=e},n.ajax=function(t,e,n,o){var i=new XMLHttpRequest;t=t.toUpperCase(),"function"==typeof n&&(o=n);var r="?";if("POST"===t){http.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var s in n)r+=s+"="+n[s]+"&"}i.onreadystatechange=function(){4==i.readyState&&200==i.status&&o(JSON.parse(i.responseText))},i.open(t,e,!0),i.send("POST"===t?r:null)},t.Moon=n,t.$=function(t){return t=document.querySelectorAll(t),1===t.length?t[0]:t}}(window);