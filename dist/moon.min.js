/*
* Moon v0.4.4
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.Moon=t()}(this,function(){"use strict";function e(e){this.instance=e}function t(t){this.$opts=t||{},this.$id=s++,this.$name=this.$opts.name||"root",this.$parent=this.$opts.parent||null,this.$data=this.$opts.data||{},this.$render=this.$opts.render||G,this.$hooks=this.$opts.hooks||{},this.$methods=this.$opts.methods||{},this.$events={},this.$dom={},this.$observer=new e(this),this.$destroyed=!1,this.$initialRender=!0,this.$queued=!1,this.init()}var n={},r={},i={},o={stop:"event.stopPropagation();",prevent:"event.preventDefault();",ctrl:"if(!event.ctrlKey) {return;};",shift:"if(!event.shiftKey) {return;};",alt:"if(!event.altKey) {return;};",enter:"if(event.keyCode !== 13) {return;};"},s=0;e.prototype.notify=function(){c(this.instance)};var a=function(e){t.config.silent||console.log(e)},u=function(e){console.error("[Moon] ERR: "+e)},c=function(e){e.$queued||e.$destroyed||(e.$queued=!0,setTimeout(function(){e.build(),R(e,"updated"),e.$queued=!1},0))},p=function(e){for(var t={},n=e.attributes,r=n.length;r--;)t[n[r].name]=n[r].value;return e.__moon__props__=t,t},l=function(){return{shouldRender:!0,component:!1,eventListeners:{}}},f=function(e){var t=/\n/g,n=/"/g;return e.replace(t,"\\n").replace(n,'\\"')},h=function(e,t,n,r){var i,o=n.split(".");for(i=0;i<o.length-1;i++){var s=o[i];t=t[s]}return t[o[i]]=r,t},v=function(e,t){var n=/{{([A-Za-z0-9_]+)([A-Za-z0-9_.()'"+\-*\/\s\[\]]+)?}}/gi,r=e;return e.replace(n,function(e,n,i){i||(i=""),r=t?r.replace(e,'" + instance.get("'+n+'")'+i+' + "'):r.replace(e,'instance.get("'+n+'")'+i)}),r},d=function(e){var t={};if(!e)return t;var n="default";t[n]=[];for(var r=0;r<e.length;r++){var i=e[r];i.props.slot?(t[i.props.slot]?t[i.props.slot].push(i):t[i.props.slot]=[i],delete i.props.slot):t[n].push(i)}return t},m=function(e,t,n,r,i){return{type:e,val:t,props:n,children:r,meta:i||l()}},y=function(e,t,n,r,i){if(i.opts.functional)return g(e,t,n,r,i)},g=function(e,t,n,r,i){var o=i.opts.data||{};if(i.opts.props)for(var s=0;s<i.opts.props.length;s++){var a=i.opts.props[s];o[a]=t[a]}return i.opts.render(b,{data:o,slots:d(r)})},$=function(e){return Array.isArray(e)?e.map($):"string"==typeof e||null===e?m("#text",e||"",{},[],l()):e},b=function(e,t,n){for(var r=[],o=arguments.length-3,s=0;s<o;s++){var a=$(arguments[s+3]);Array.isArray(a)?(r.splice.apply(r,[s,0].concat(a)),s++):r[s]=a}return i[e]?y(e,t,n,r,i[e]):m(e,"",t,r,n)},k=function(e,t,n){var r=t.meta.eventListeners;for(var i in r)for(var o=0;o<r[i].length;o++){var s=r[i][o];e.addEventListener(i,s)}},x=function(e,t){var n;if("#text"===e.type)n=document.createTextNode(e.val);else{if(n=document.createElement(e.type),1===e.children.length&&"#text"===e.children[0].type)n.textContent=e.children[0].val;else for(var r=0;r<e.children.length;r++)n.appendChild(x(e.children[r],t));k(n,e,t)}return n.__moon__props__=C({},e.props),_(n,{},e,e.props),n},_=function(e,t,i,o){var s=L(t,o);for(var a in s)!o[a]||n[a]||r[a]?(n[a]&&n[a](e,s[a],i),e.removeAttribute(a),delete e.__moon__props__[a]):t[a]&&t[a]===o[a]||(e.setAttribute(a,o[a]),e.__moon__props__[a]=o[a])},A=function(e,t,n,r){var i;if(e&&(i=e.nodeName.toLowerCase()),!e&&t&&t.meta.shouldRender){var o=x(t,r);return n.appendChild(o),o}if(!t)return n.removeChild(e),null;if(i!==t.type){var o=x(t,r);return n.replaceChild(o,e),o}if("#text"===t.type&&"#text"===i)return e.textContent=t.val,e;if(t&&t.meta.shouldRender){var s=e.__moon__props__||p(e);_(e,s,t,t.props),r.$initialRender&&k(e,t,r);var a=e.firstChild;if(1===t.children.length&&"#text"===t.children[0].type&&a&&!a.nextSibling&&"#text"===a.nodeName)return void(a.textContent=t.children[0].val);for(var u=0;u<t.children.length||a;u++){var c=a?a.nextSibling:null,o=A(a,t.children[u],e,r);a=c}}},C=function(e,t){for(var n in t)e[n]=t[n];return e},L=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},R=function(e,t){var n=e.$hooks[t];n&&n()},G=function(){},O=function(e){var t={input:e,current:0,tokens:[]};return E(t),t.tokens},E=function(e){for(var t=e.input,n=t.length;e.current<n;)"<"===t.charAt(e.current)?"<!--"!==t.substr(e.current,4)?w(e):D(e):S(e)},S=function(e){var t=e.input,n=t.length,r=t.indexOf("<",e.current);return r===-1?(e.tokens.push({type:"text",value:t.slice(e.current)}),void(e.current=n)):void(r!==e.current&&(e.tokens.push({type:"text",value:t.slice(e.current,r)}),e.current=r))},D=function(e){var t=e.input,n=t.length;e.current+=4;var r=t.indexOf("-->",e.current);return r===-1?(e.tokens.push({type:"comment",value:t.slice(e.current)}),void(e.current=n)):(e.tokens.push({type:"comment",value:t.slice(e.current,r)}),void(e.current=r+3))},w=function(e){var t=e.input,n=(t.length,"/"===t.charAt(e.current+1));e.tokens.push({type:"tagStart",close:n}),e.current+=n?2:1;var r=T(e);j(e);var i="/"===t.charAt(e.current);e.tokens.push({type:"tagEnd",close:!1}),e.current+=i?2:1,i&&(e.tokens.push({type:"tagStart",close:!0}),e.tokens.push({type:"tag",value:r}),e.tokens.push({type:"attribute",value:{}}),e.tokens.push({type:"tagEnd",close:!1}))},T=function(e){for(var t=e.input,n=t.length,r=e.current;r<n;){var i=t.charAt(r);if("/"!==i&&">"!==i&&" "!==i)break;r++}for(var o=r;o<n;){var i=t.charAt(o);if("/"===i||">"===i||" "===i)break;o++}var s=t.slice(r,o);return e.tokens.push({type:"tag",value:s}),e.current=o,s},j=function(e){for(var t=e.input,n=t.length,r=e.current,i={},o="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var a=t.charAt(r),u=t.charAt(r+1);if(">"===a||"/"===a&&">"===u)break;o+=a,r++}o.replace(s,function(e,t,n,r){var o=r[0],s=r[r.length-1];("'"===o&&"'"===s||'"'===o&&'"'===s)&&(r=r.slice(1,-1)),r||(r=t),t&&r&&(i[t]=r)}),e.current=r,e.tokens.push({type:"attribute",value:i})},q=function(e){for(var t={type:"ROOT",children:[]},n={current:0,tokens:e};n.current<e.length;){var r=K(n);r&&t.children.push(r)}return t},M={html:!0,body:!0,head:!0,style:!0,title:!0,address:!0,article:!0,aside:!0,footer:!0,header:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,hgroup:!0,nav:!0,section:!0,div:!0,dd:!0,dl:!0,dt:!0,figcaption:!0,figure:!0,li:!0,main:!0,ol:!0,p:!0,pre:!0,ul:!0,a:!0,b:!0,abbr:!0,bdi:!0,bdo:!0,cite:!0,code:!0,data:!0,dfn:!0,em:!0,i:!0,kbd:!0,mark:!0,q:!0,rp:!0,rt:!0,rtc:!0,ruby:!0,s:!0,samp:!0,small:!0,span:!0,strong:!0,sub:!0,sup:!0,time:!0,u:!0,var:!0,audio:!0,map:!0,video:!0,object:!0,canvas:!0,script:!0,noscript:!0,del:!0,ins:!0,caption:!0,colgroup:!0,table:!0,thead:!0,tbody:!0,td:!0,th:!0,tr:!0,button:!0,datalist:!0,fieldset:!0,form:!0,label:!0,legend:!0,meter:!0,optgroup:!0,option:!0,output:!0,progress:!0,select:!0,textarea:!0,details:!0,dialog:!0,menu:!0,menuitem:!0,summary:!0,content:!0,element:!0,shadow:!0,template:!0},N=function(e,t,n){return{type:e,props:t,children:n}},K=function(e){var t=e.tokens[e.current],n=e.tokens[e.current-1],r=e.tokens[e.current+1],i=e.tokens[e.current+2],o=e.tokens[e.current+3],s=function(o){e.current+=void 0===o?1:o,t=e.tokens[e.current],n=e.tokens[e.current-1],r=e.tokens[e.current+1],i=e.tokens[e.current+2]};if("text"===t.type)return s(),n.value;if("comment"===t.type)return void s();if("tagStart"===t.type&&!t.close&&!o.close){var a=N(r.value,i.value,[]);r.value;s(4);e.current;if(t){for(;"tagStart"!==t.type||"tagStart"===t.type&&!t.close;){var u,c=K(e);if(c&&(u={node:c,index:a.children.length},a.children.push(c)),s(0),!t){if(u&&!M[u.node.type]){var p=u.node.children;a.children[u.index].children=[],a.children=a.children.concat(p)}break}}s()}return a}s()},z=function(e){var t=e.props;if(0===Object.keys(t).length)return"{}";var n="{";for(var i in t)r[i]?(r[i].afterGenerate&&(e.specialDirectivesAfter?e.specialDirectivesAfter[i]=t[i]:(e.specialDirectivesAfter={},e.specialDirectivesAfter[i]=t[i])),r[i].beforeGenerate&&r[i].beforeGenerate(t[i],e),delete t[i]):n+='"'+i+'": '+v(JSON.stringify(t[i]),!0)+", ";return n=n.length>1?n.slice(0,-2)+"}":n+"}"},F=function(e){if(0===Object.keys(e).length)return"{}";var t="{";for(var n in e)t+='"'+n+'": ['+H(e[n])+"], ";return t=t.slice(0,-2)+"}"},Z=function(e){var t="{";for(var n in e)t+="eventListeners"===n?'"'+n+'": '+F(e[n])+", ":'"'+n+'": '+e[n]+", ";return t=t.slice(0,-2)+"}"},H=function(e){for(var t="",n=0;n<e.length;n++)t+=e[n]+", ";return t=t.slice(0,-2)},J=function(e,t){var n='h("'+e.type+'", ';return n+=z(e)+", ",n+=Z(e.meta)+", ",n+=t.length?H(t):'""',n+=")"},P=function(e){var t="";if("string"==typeof e)t+='"'+v(f(e),!0)+'"';else{var n=e.children.map(P);e.meta||(e.meta=l());var i=J(e,n);if(e.specialDirectivesAfter)for(var o in e.specialDirectivesAfter)i=r[o].afterGenerate(e.specialDirectivesAfter[o],i,e);t+=i}return t},B=function(e){var t=e.children[0],n="var instance = this; return "+P(t);try{return new Function("h",n)}catch(e){return u("Could not create render function"),G}},I=function(e){var t=O(e),n=q(t);return B(n)};return t.prototype.get=function(e){return this.$data[e]},t.prototype.set=function(e,t){h(this,this.$data,e,t),this.$observer.notify()},t.prototype.destroy=function(){this.removeEvents(),this.$destroyed=!0,R(this,"destroyed")},t.prototype.callMethod=function(e,t){t=t||[],this.$methods[e].apply(this,t)},t.prototype.on=function(e,t){this.$events[e]?this.$events[e].push(t):this.$events[e]=[t]},t.prototype.off=function(e,t){var n=this.$events[e].indexOf(t);n!==-1&&this.$events[e].splice(n,1)},t.prototype.removeEvents=function(){for(var e in this.$events)this.$events[e]=[]},t.prototype.emit=function(e,t){if(t=t||{},t.type=e,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(t)}for(var n=0;n<this.$events[e].length;n++){var i=this.$events[e][n];i(t)}},t.prototype.renderLoop=function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n},t.prototype.mount=function(e){this.$el=document.querySelector(e),this.$destroyed=!1,this.$el||u("Element "+this.$opts.el+" not found"),this.$el.__moon__=this,this.$template=this.$opts.template||this.$el.outerHTML,this.$render===G&&(this.$render=t.compile(this.$template)),this.build(),R(this,"mounted")},t.prototype.render=function(){return this.$render(b)},t.prototype.patch=function(e,t,n){A(e,t,n,this),this.$initialRender=!1},t.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom,this.$el.parentNode)},t.prototype.init=function(){a("======= Moon ======="),R(this,"init"),this.$opts.el&&this.mount(this.$opts.el)},t.config={silent:"undefined"==typeof console,prefix:"m-",keyCodes:function(e){for(var t in e)o[t]="if(event.keyCode !== "+e[t]+") {return;};"}},t.version="0.4.4",t.util={noop:G,error:u,log:a,merge:L,extend:C},t.use=function(e){e.init(t)},t.compile=function(e){return I(e)},t.nextTick=function(e){setTimeout(e,0)},t.directive=function(e,r){n[t.config.prefix+e]=r},t.component=function(e,n){function r(){t.call(this,n)}var o=this;return n.name=e,n.parent=o,r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.init=function(){R(this,"init"),this.$destroyed=!1,this.$props=this.$opts.props||[],this.$template=this.$opts.template,this.$render===G&&(this.$render=t.compile(this.$template))},i[e]={CTor:r,opts:n},r},r[t.config.prefix+"if"]={afterGenerate:function(e,t,n){return"("+v(e,!1)+") ? "+t+" : ''"}},r[t.config.prefix+"for"]={afterGenerate:function(e,t,n){var r=e.split(" in "),i=r[0].split(","),o=v(r[1],!1),s=i.join(",");return t.replace(/instance\.get\("([^"]+)"\)/g,function(e,n){i.indexOf(n)!==-1&&(t=t.replace(new RegExp('instance.get\\("'+n+'"\\)',"g"),n))}),"instance.renderLoop("+o+", function("+s+") { return "+t+"; })"}},r[t.config.prefix+"on"]={beforeGenerate:function(e,t){e=v(e,!1);var n=e.split(":"),r=n[0].split("."),i=r[0],s=n[1],a="(event)",u=s.split("(")[1];u&&(a="");var c="";r.shift();for(var p=0;p<r.length;p++)c+=o[r[p]];var l="function(event) {"+c+"instance.$methods."+s+a+"}";t.meta.eventListeners[i]?t.meta.eventListeners[i].push(l):t.meta.eventListeners[i]=[l]}},r[t.config.prefix+"model"]={beforeGenerate:function(e,t){var n='function(event) {instance.set("'+e+'", event.target.value)}';t.meta.eventListeners.input?t.meta.eventListeners.input.push(n):t.meta.eventListeners.input=[n]}},r[t.config.prefix+"once"]={beforeGenerate:function(e,t){t.meta.shouldRender="instance.$initialRender"}},r[t.config.prefix+"pre"]={beforeGenerate:function(e,t){t.meta.shouldRender=!1}},n[t.config.prefix+"show"]=function(e,t,n){var r=new Function("return "+t);r()?e.style.display="block":e.style.display="none"},n[t.config.prefix+"text"]=function(e,t,n){e.textContent=t,n.children[0].val=t},n[t.config.prefix+"mask"]=function(e,t,n){},t});