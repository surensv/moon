/*
* Moon v0.6.2
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.Moon=t()}(this,function(){"use strict";function e(e){this.instance=e,this.cache={}}function t(t){this.$opts=t||{},this.$id=s++,this.$name=this.$opts.name||"root",this.$data=this.$opts.data||{},this.$render=this.$opts.render||R,this.$hooks=this.$opts.hooks||{},this.$methods=this.$opts.methods||{},this.$events={},this.$dom={},this.$observer=new e(this),this.$destroyed=!1,this.$initialRender=!0,this.$queued=!1,this.$opts.computed&&a(this,this.$opts.computed),this.init()}var r={},n={},o={},i={stop:"event.stopPropagation();",prevent:"event.preventDefault();",ctrl:"if(!event.ctrlKey) {return;};",shift:"if(!event.shiftKey) {return;};",alt:"if(!event.altKey) {return;};",enter:"if(event.keyCode !== 13) {return;};"},s=0,a=function(e,t){var r=function(r){e.$observer.cache[r]={dirty:!0,getter:t[r].get,cache:null};var n={get:function(){return e.$observer.getComputed(r)}};t[r].set&&(n.set=function(n){return t[r].set.call(e,n)}),Object.defineProperty(e.$data,r,n)};for(var n in t)r(n)};e.prototype.getComputed=function(e){if(this.cache[e].dirty){var t=this.cache[e].getter.call(this.instance);return this.cache[e].cache=t,t}return this.cache[e].cache},e.prototype.notify=function(){u(this.instance)};var c=function(e){t.config.silent||console.log(e)},p=function(e){console.error("[Moon] ERR: "+e)},u=function(e){e.$queued||e.$destroyed||(e.$queued=!0,setTimeout(function(){e.build(),G(e,"updated"),e.$queued=!1},0))},f=function(e){for(var t={},r=e.attributes,n=r.length;n--;)t[r[n].name]=r[n].value;return e.__moon__props__=t,t},l=function(){return{shouldRender:!0,eventListeners:{}}},h=function(e){var t=/\n/g,r=/"/g,n=/\\/g;return e.replace(n,"\\\\").replace(r,'\\"').replace(t,"\\n")},d=function(e,t,r,n){var o;r.replace(/\[(\w+)\]/g,function(e,t){r=r.replace(e,"."+t)});var i=r.split(".");for(o=0;o<i.length-1;o++){var s=i[o];t=t[s]}return t[i[o]]=n,t},v=function(e,t){var r=/{{([A-Za-z0-9_]+)([A-Za-z0-9_.()'"+\-*\/\s\[\]]+)?}}/gi,n=e;return e.replace(r,function(e,r,o){o||(o=""),n=t?n.replace(e,'" + instance.get("'+r+'")'+o+' + "'):n.replace(e,'instance.get("'+r+'")'+o)}),n},m=function(e){var t={};if(!e)return t;var r="default";t[r]=[];for(var n=0;n<e.length;n++){var o=e[n],i=o.props.attrs;i.slot?(t[i.slot]?t[i.slot].push(o):t[i.slot]=[o],delete i.slot):t[r].push(o)}return t},y=function(e,t,r,n,o){return{type:e,val:t,props:r,children:n,meta:o||l()}},g=function(e,t,r,n,o){var i=o.opts.data||{};if(o.opts.props)for(var s=0;s<o.opts.props.length;s++){var a=o.opts.props[s];i[a]=t.attrs[a]}return o.opts.render($,{data:i,slots:m(n)})},$=function(e,t,r){for(var n=[],i=arguments.length-3,s=0;s<i;s++){var a=arguments[s+3];Array.isArray(a)?n=n.concat(a):"string"==typeof a||null===a?n.push(y("#text",a||"",{attrs:{}},[],l())):n.push(a)}if(o[e]){if(o[e].opts.functional)return g(e,t,r,n,o[e]);r.component=o[e]}return y(e,"",t,n,r)},_=function(e,t,r){var n=t.meta.eventListeners;for(var o in n)for(var i=0;i<n[o].length;i++){var s=n[o][i];e.addEventListener(o,s)}},k=function(e,t){var r;if("#text"===e.type)r=document.createTextNode(e.val);else{if(r=document.createElement(e.type),1===e.children.length&&"#text"===e.children[0].type)r.textContent=e.children[0].val;else for(var n=0;n<e.children.length;n++){var o=e.children[n],i=k(e.children[n],t);r.appendChild(i),o.meta.component&&x(i,o,o.meta.component)}_(r,e,t)}return r.__moon__props__=C({},e.props.attrs),b(r,{},e,e.props.attrs),r.__moon__nodeName__=e.type,r},x=function(e,t,r){for(var n=new r.CTor,o=0;o<n.$props.length;o++){var i=n.$props[o];n.$data[i]=t.props.attrs[i]}return n.$slots=m(t.children),n.$el=e,n.build(),G(n,"mounted"),n.$el},b=function(e,t,n,o){var i=L(t,o);for(var s in i)!o[s]||r[s]?(r[s]&&r[s](e,i[s],n),e.removeAttribute(s),delete e.__moon__props__[s]):t[s]&&t[s]===o[s]||(e.setAttribute(s,o[s]),e.__moon__props__[s]=o[s]);if(n.props.dom)for(var a in n.props.dom){n.props.dom[a];e[a]!==n.props.dom[a]&&(e[a]=n.props.dom[a])}},A=function(e,t,r,n){var o;if(e&&(o=e.__moon__nodeName__||e.nodeName.toLowerCase()),!e&&t){var i=k(t,n);return r.appendChild(i),t.meta.component&&x(i,t,t.meta.component),i}if(t){if(o!==t.type){var i=k(t,n);return r.replaceChild(i,e),e.__moon__&&e.__moon__.destroy(),t.meta.component&&x(i,t,t.meta.component),i}if(t.meta.shouldRender&&"#text"===t.type&&"#text"===o&&t.val!==e.textContent)return e.textContent=t.val,e;if(t&&"#text"!==t.type&&t.meta.shouldRender){if(t.meta.component){if(e.__moon__){var s=e.__moon__,a=!1;for(var c in t.props.attrs)s.$data[c]!==t.props.attrs[c]&&(s.$data[c]=t.props.attrs[c],a=!0);t.children&&(s.$slots=m(t.children),a=!0),a&&s.build()}else x(e,t,t.meta.component);return e}var p=e.__moon__props__||f(e);if(b(e,p,t,t.props.attrs),n.$initialRender&&_(e,t,n),t.props.dom&&t.props.dom.innerHTML)return e;var u=e.firstChild;if(1===t.children.length&&"#text"===t.children[0].type&&u&&!u.nextSibling&&"#text"===u.nodeName&&t.children[0].val!==u.textContent)u.textContent=t.children[0].val;else for(var l=0;l<t.children.length||u;l++){var h=u?u.nextSibling:null;A(u,t.children[l],e,n),u=h}return e}return e}return r.removeChild(e),e.__moon__&&e.__moon__.destroy(),null},C=function(e,t){for(var r in t)e[r]=t[r];return e},L=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},G=function(e,t){var r=e.$hooks[t];r&&r.call(e)},R=function(){},O=function(e){var t={input:e,current:0,tokens:[]};return T(t),t.tokens},T=function(e){for(var t=e.input,r=t.length;e.current<r;)"<"===t.charAt(e.current)?"<!--"!==t.substr(e.current,4)?E(e):j(e):w(e)},w=function(e){var t=e.input,r=t.length,n=t.indexOf("<",e.current);return n===-1?(e.tokens.push({type:"text",value:t.slice(e.current)}),void(e.current=r)):void(n!==e.current&&(e.tokens.push({type:"text",value:t.slice(e.current,n)}),e.current=n))},j=function(e){var t=e.input,r=t.length;e.current+=4;var n=t.indexOf("-->",e.current);return n===-1?(e.tokens.push({type:"comment",value:t.slice(e.current)}),void(e.current=r)):(e.tokens.push({type:"comment",value:t.slice(e.current,n)}),void(e.current=n+3))},E=function(e){var t=e.input,r=(t.length,"/"===t.charAt(e.current+1));e.tokens.push({type:"tagStart",close:r}),e.current+=r?2:1;var n=S(e);D(e);var o="/"===t.charAt(e.current);e.tokens.push({type:"tagEnd",close:!1}),e.current+=o?2:1,o&&(e.tokens.push({type:"tagStart",close:!0}),e.tokens.push({type:"tag",value:n}),e.tokens.push({type:"attribute",value:{}}),e.tokens.push({type:"tagEnd",close:!1}))},S=function(e){for(var t=e.input,r=t.length,n=e.current;n<r;){var o=t.charAt(n);if("/"!==o&&">"!==o&&" "!==o)break;n++}for(var i=n;i<r;){var o=t.charAt(i);if("/"===o||">"===o||" "===o)break;i++}var s=t.slice(n,i);return e.tokens.push({type:"tag",value:s}),e.current=i,s},D=function(e){for(var t=e.input,r=t.length,n=e.current,o={},i=t.charAt(n),s=t.charAt(n+1),a=function(){n++,i=t.charAt(n),s=t.charAt(n+1)};n<r&&">"!==i&&("/"!==i||">"!==s);)if(" "!==i){for(var c="",p=!1;"="!==i&&n<r;){if(!(" "!==i&&">"!==i||"/"===i&&">"!==s)){p=!0;break}c+=i,a()}if(p)o[c]="";else{var u="",f=" ";for(a(),"'"===i||'"'===i?(f=i,a()):u+=i;(i!==f&&">"!==i||"/"===i&&">"!==s)&&n<r;)u+=i,a();o[c]=u,a()}}else a();e.current=n,e.tokens.push({type:"attribute",value:o})},M=function(e){for(var t={type:"ROOT",children:[]},r={current:0,tokens:e};r.current<e.length;){var n=P(r);n&&t.children.push(n)}return t},N=["area","base","br","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],q=function(e,t,r){return{type:e,props:t,children:r}},P=function(e){var t=e.tokens[e.current],r=e.tokens[e.current-1],n=e.tokens[e.current+1],o=e.tokens[e.current+2],i=e.tokens[e.current+3],s=function(i){e.current+=void 0===i?1:i,t=e.tokens[e.current],r=e.tokens[e.current-1],n=e.tokens[e.current+1],o=e.tokens[e.current+2]};if("text"===t.type)return s(),r.value;if("comment"===t.type)return void s();if("tagStart"===t.type&&!t.close&&!i.close){var a=q(n.value,o.value,[]);n.value;if(s(4),N.indexOf(a.type)!==-1)return a;e.current;if(t){for(;"tagStart"!==t.type||"tagStart"===t.type&&!t.close;){var c=P(e);if(c&&a.children.push(c),s(0),!t){p('The element "'+a.type+'" was left unclosed.');break}}s()}return a}s()},H=function(e){var t=e.props.attrs,o="{attrs: {";if(t){for(var i in t)if(r[i]&&(e.dynamic=!0),n[i])n[i].afterGenerate&&(e.specialDirectivesAfter?e.specialDirectivesAfter[i]=t[i]:(e.specialDirectivesAfter={},e.specialDirectivesAfter[i]=t[i])),n[i].beforeGenerate&&n[i].beforeGenerate(t[i],e),n[i].duringPropGenerate&&(o+=n[i].duringPropGenerate(t[i],e)),e.dynamic=!0,delete t[i];else{var s=JSON.stringify(t[i]),a=v(s,!0);s!==a&&(e.dynamic=!0),o+='"'+i+'": '+a+", "}Object.keys(t).length?o=o.slice(0,-2)+"}":o+="}"}var c=e.props.dom;if(c){e.dynamic=!0,o+=", dom: {";for(var p in c)o+='"'+p+'": '+c[p]+", ";o=o.slice(0,-2)+"}"}return o+="}"},K=function(e){if(0===Object.keys(e).length)return"{}";var t="{";for(var r in e)t+='"'+r+'": ['+F(e[r])+"], ";return t=t.slice(0,-2)+"}"},z=function(e){var t="{";for(var r in e)t+="eventListeners"===r?'"'+r+'": '+K(e[r])+", ":'"'+r+'": '+e[r]+", ";return t=t.slice(0,-2)+"}"},F=function(e){for(var t="",r=0;r<e.length;r++)t+=e[r]+", ";return t=t.slice(0,-2)},Z=function(e){var t='h("'+e.type+'", ';t+=H(e)+", ";var r=e.children.map(J);return 1!==e.children.length||1!==r.length||"string"!=typeof e.children[0]||'"'+e.children[0]+'"'!==r[0]||e.dynamic||(e.meta.shouldRender="instance.$initialRender"),t+=z(e.meta),t+=r.length?", "+F(r):"",t+=")"},J=function(e){var t="";if("string"==typeof e)t+='"'+v(h(e),!0)+'"';else{e.meta||(e.meta=l()),e.props={attrs:e.props};var r="slot"===e.type?"instance.$slots['"+(e.props.attrs.name||"default")+"']":Z(e);if(e.specialDirectivesAfter)for(var o in e.specialDirectivesAfter)r=n[o].afterGenerate(e.specialDirectivesAfter[o],r,e);t+=r}return t},B=function(e){var t=e.children[0],r="var instance = this; return "+J(t);try{return new Function("h",r)}catch(e){return p("Could not create render function"),R}},I=function(e){var t=O(e),r=M(t);return B(r)};return t.prototype.get=function(e){return this.$data[e]},t.prototype.set=function(e,t){d(this,this.$data,e,t),this.$observer.notify()},t.prototype.destroy=function(){this.removeEvents(),this.$el=null,this.$destroyed=!0,G(this,"destroyed")},t.prototype.callMethod=function(e,t){t=t||[],this.$methods[e].apply(this,t)},t.prototype.on=function(e,t){this.$events[e]?this.$events[e].push(t):this.$events[e]=[t]},t.prototype.off=function(e,t){var r=this.$events[e].indexOf(t);r!==-1&&this.$events[e].splice(r,1)},t.prototype.removeEvents=function(){for(var e in this.$events)this.$events[e]=[]},t.prototype.emit=function(e,t){if(t=t||{},t.type=e,this.$events["*"])for(var r=0;r<this.$events["*"].length;r++){var n=this.$events["*"][r];n(t)}for(var r=0;r<this.$events[e].length;r++){var o=this.$events[e][r];o(t)}},t.prototype.renderLoop=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r},t.prototype.renderClass=function(e){if("string"==typeof e)return e;var t="";if(Array.isArray(e))for(var r=0;r<e.length;r++)t+=this.renderClass(e[r])+" ";else if("object"==typeof e)for(var n in e)e[n]&&(t+=n+" ");return t=t.slice(0,-1)},t.prototype.mount=function(e){this.$el=document.querySelector(e),this.$destroyed=!1,this.$el||p("Element "+this.$opts.el+" not found"),this.$el.__moon__=this,this.$template=this.$opts.template||this.$el.outerHTML,this.$render===R&&(this.$render=t.compile(this.$template)),this.build(),G(this,"mounted")},t.prototype.render=function(){return this.$render($)},t.prototype.patch=function(e,t,r){var n=A(e,t,r,this);e!==n&&(this.$el=n,this.$el.__moon__=this),this.$initialRender=!1},t.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom,this.$el.parentNode)},t.prototype.init=function(){c("======= Moon ======="),G(this,"init"),this.$opts.el&&this.mount(this.$opts.el)},t.config={silent:"undefined"==typeof console,prefix:"m-",keyCodes:function(e){for(var t in e)i[t]="if(event.keyCode !== "+e[t]+") {return;};"}},t.version="0.6.2",t.util={noop:R,error:p,log:c,merge:L,extend:C},t.use=function(e){e.init(t)},t.compile=function(e){return I(e)},t.nextTick=function(e){setTimeout(e,0)},t.directive=function(e,n){r[t.config.prefix+e]=n},t.component=function(e,r){function n(){t.call(this,r)}var i=this;return r.name=e,n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n.prototype.init=function(){G(this,"init"),this.$destroyed=!1,this.$props=this.$opts.props||[],this.$template=this.$opts.template,this.$render===R&&(this.$render=t.compile(this.$template))},o[e]={CTor:n,opts:r},n},n[t.config.prefix+"if"]={afterGenerate:function(e,t,r){return"("+v(e,!1)+") ? "+t+" : ''"}},n[t.config.prefix+"for"]={afterGenerate:function(e,t,r){var n=e.split(" in "),o=n[0].split(","),i=v(n[1],!1),s=o.join(",");return t.replace(/instance\.get\("([^"]+)"\)/g,function(e,r){o.indexOf(r)!==-1&&(t=t.replace(new RegExp('instance.get\\("'+r+'"\\)',"g"),r))}),"instance.renderLoop("+i+", function("+s+") { return "+t+"; })"}},n[t.config.prefix+"on"]={beforeGenerate:function(e,t){e=v(e,!1);var r=e.split(":"),n=r[0].split("."),o=n[0],s=r[1],a="event",c=s.split("(");c.length>1&&(s=c.shift(),a=c.join("(").slice(0,-1));var p="";n.shift();for(var u=0;u<n.length;u++)p+=i[n[u]];var f="function(event) {"+p+'instance.callMethod("'+s+'", ['+a+"])}";t.meta.eventListeners[o]?t.meta.eventListeners[o].push(f):t.meta.eventListeners[o]=[f]}},n[t.config.prefix+"model"]={beforeGenerate:function(e,t){var r=v(e,!0),n="input",o="value";"checkbox"===t.props.attrs.type&&(n="change",o="checked");var i='function(event) {instance.set("'+r+'", event.target.'+o+")}";t.meta.eventListeners[n]?t.meta.eventListeners[n].push(i):t.meta.eventListeners[n]=[i];var s=v("{{"+v(e,!1)+"}}",!1);t.props.dom||(t.props.dom={}),t.props.dom[o]=s}},n[t.config.prefix+"literal"]={duringPropGenerate:function(e,t){var r=e.split(":"),n=r.shift(),o=r.join(":");return t.props.attrs[n]=!0,"class"===n?'"class": instance.renderClass('+v(o,!1)+"), ":'"'+n+'": '+v(o,!1)+", "}},n[t.config.prefix+"once"]={beforeGenerate:function(e,t){t.meta.shouldRender="instance.$initialRender"}},n[t.config.prefix+"pre"]={beforeGenerate:function(e,t){t.meta.shouldRender=!1}},n[t.config.prefix+"html"]={beforeGenerate:function(e,t){t.props.dom||(t.props.dom={}),t.props.dom.innerHTML='"'+v(e,!0)+'"'}},n[t.config.prefix+"text"]={beforeGenerate:function(e,t){t.children=[e]}},r[t.config.prefix+"show"]=function(e,t,r){var n=new Function("return "+t);n()?e.style.display="block":e.style.display="none"},r[t.config.prefix+"mask"]=function(e,t,r){},t});