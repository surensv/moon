/*
* Moon 0.1.3
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){function t(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function e(e){this.$opts=e||{};var s=this,d=this.$opts.data;this.$id=r++,this.$render=this.$opts.render||f,this.$hooks=t({created:f,mounted:f,updated:f,destroyed:f},this.$opts.hooks),this.$methods=this.$opts.methods||{},this.$components=t(this.$opts.components||{},i),this.$directives=t(this.$opts.directives||{},n),this.$events={},this.$dom={},this.$destroyed=!1,Object.defineProperty(this,"$data",{get:function(){return d},set:function(t){d=t,this.build(this.$dom.children)},configurable:!0}),n[o.prefix+"if"]=function(t,e,o){var n=new Function("return "+e);if(n())for(var i=0;i<o.children.length;i++)o.children[i].meta.shouldRender=!0;else for(var i=0;i<o.children.length;i++)o.children[i].node.textContent="",o.children[i].meta.shouldRender=!1},n[o.prefix+"show"]=function(t,e,o){var n=new Function("return "+e);n()?t.style.display="block":t.style.display="none"},n[o.prefix+"on"]=function(t,e,n){var i=e.split(":"),r=i[0],d=i[1];s.$events[r]?s.on(r,d):t.addEventListener(r,function(t){s.callMethod(d,[t])}),delete n.props[o.prefix+"on"]},n[o.prefix+"model"]=function(t,e,n){t.value=s.get(e),t.addEventListener("input",function(){s.set(e,t.value)}),delete n.props[o.prefix+"model"]},n[o.prefix+"for"]=function(t,e,o){var n=e.split(" in ");n[0],s.get(n[1])},n[o.prefix+"once"]=function(t,e,o){o.meta.shouldRender=!1},n[o.prefix+"text"]=function(t,e,o){t.textContent=e},n[o.prefix+"html"]=function(t,e,o){t.innerHTML=e},n[o.prefix+"mask"]=function(t,e,o){},this.init()}var o={silent:!1,prefix:"m-"},n={},i={},r=0,s=function(t){var e=t,o=/{{([A-Za-z0-9_.()\[\]]+)}}/gi;e.replace(o,function(t,o){e=e.replace(t,"' + data['"+o+"'] + '")}),e=e.replace(/\n/g,"' + \n'");var n=new Function("data","var out = '"+e+"'; return out");return n},d=function(t){var e={};if(!t.attributes)return e;for(var o=t.attributes,n=0;n<o.length;n++)e[o[n].name]=o[n].value;return e},p=function(t,e,o,n,i,r){return{type:t,val:e,compiled:e,props:o,compiledProps:o,children:n,meta:i,node:r}},h=function(t){for(var e=t.nodeName,o=t.textContent,n=d(t),i={shouldRender:!0},r=[],s=0;s<t.childNodes.length;s++)r.push(h(t.childNodes[s]));return p(e,o,n,r,i,t)},u=function(t,e){for(var o=0;o<t.children.length;o++){var n=t.children[o];if(n.compiled=s(n.val)(e),n.props)for(var i in n.props)n.compiledProps[i]=s(n.props[i])(e);n.children&&(n=u(n,e))}return t},c=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),o=t.shift()||{},n=t;return p(e,n.join(""),o,n)},l=function(t,e){t.innerHTML=e},f=function(){},a=void 0!==typeof window.console;return e.prototype.log=function(t){!o.silent&&a&&console.log(t)},e.prototype.error=function(t){a&&console.error("[Moon] ERR: "+t)},e.prototype.get=function(t){return this.$data[t]},e.prototype.set=function(t,e){this.$data[t]=e,this.$destroyed||this.build(),this.$hooks.updated()},e.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},e.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},e.prototype.off=function(t,e){var o=this.$events[t].indexOf(e);o!==-1&&this.$events[t].splice(o,1)},e.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},e.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var o=0;o<this.$events["*"].length;o++){var n=this.$events["*"][o];n(e)}for(var o=0;o<this.$events[t].length;o++){var i=this.$events[t][o];i(e)}},e.prototype.mount=function(t){this.$el=document.querySelector(t),this.$el||this.error("Element "+this.$opts.el+" not found"),this.$template=this.$opts.template||this.$el.innerHTML,l(this.$el,this.$template),this.$opts.render?this.$dom=this.$opts.render(c):this.$dom=h(this.$el),this.build(),this.$hooks.mounted()},e.prototype.render=function(){return this.$opts.render?this.$opts.render(c):u(this.$dom,this.$data)},e.prototype.destroy=function(){Object.defineProperty(this,"$data",{set:function(t){_data=t}}),this.removeEvents(),this.$destroyed=!0,this.$hooks.destroyed()},e.prototype.build=function(){this.$dom=this.render(),this.buildNodes(this.$dom)},e.prototype.buildNodes=function(t){for(var e=0;e<t.children.length;e++){var o=t.children[e];if(o.meta.shouldRender){if("#text"===o.type){var i="";i=o.compiled,i===o.val&&(child.meta.shouldRender=!1),o.node.textContent=i}else if(o.props)for(var r in o.compiledProps){var s=o.compiledProps[r];n[r]?(o.node.removeAttribute(r),n[r](o.node,s,o)):o.node.setAttribute(r,s)}this.buildNodes(o)}}},e.prototype.init=function(){this.log("======= Moon ======="),this.$hooks.created(),this.$opts.el&&this.mount(this.$opts.el)},e.config=function(t){t.silent&&(o.silent=t.silent),t.prefix&&(o.prefix=t.prefix+"-")},e.use=function(t){t.init(e)},e.directive=function(t,e){n[o.prefix+t]=e},e.component=function(t,o){function n(){e.call(this,o)}var r=this;n.prototype=Object.create(r.prototype),n.prototype.constructor=n;var s=new n;return i[t]=s,s},e});