/*
* Moon 0.1.3
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){"use strict";function t(i){this.$opts=i||{};var s=this,u=this.$opts.data;this.$id=o++,this.$render=this.$opts.render||$,this.$hooks=y({created:$,mounted:$,updated:$,destroyed:$},this.$opts.hooks),this.$methods=this.$opts.methods||{},this.$components=y(this.$opts.components||{},r),this.$directives=y(this.$opts.directives||{},e),this.$events={},this.$dom={},this.$destroyed=!1,this.$queued=!1,Object.defineProperty(this,"$data",{get:function(){return u},set:function(t){u=t,this.build(this.$dom.children)},configurable:!0}),n[t.config.prefix+"if"]=function(t,e,n){return"("+a(t,!1)+") ? "+e+" : ''"},n[t.config.prefix+"for"]=function(t,e,n){var r=t.split(" in "),o=r[0],i='this.get("'+r[1]+'")',s=function(t,e,n){return t.replace(e,'" + '+n+' + "')};return"this.renderLoop("+i+", function("+o+") { return "+a(e,!0,s)+"; })"},n[t.config.prefix+"on"]=function(t,e,n){var r=t.split(":"),o=r[0],i=r[1];return n.meta.eventListeners[o]?n.meta.eventListeners[o].push(i):n.meta.eventListeners[o]=[i],h(n)},e[t.config.prefix+"model"]=function(t,e,n){t.value=s.get(e),t.addEventListener("input",function(){s.set(e,t.value)})},e[t.config.prefix+"show"]=function(t,e,n){var r=new Function("return "+e);r()?t.style.display="block":t.style.display="none"},e[t.config.prefix+"once"]=function(t,e,n){n.meta.shouldRender=!1},e[t.config.prefix+"text"]=function(t,e,n){t.textContent=e;for(var r=0;r<n.children.length;r++)n.children[r].meta.shouldRender=!1},e[t.config.prefix+"html"]=function(t,e,n){t.innerHTML=e;for(var r=0;r<n.children.length;r++)n.children[r].meta.shouldRender=!1},e[t.config.prefix+"mask"]=function(t,e,n){},this.init()}var e={},n={},r={},o=0,i=function(e){t.config.silent||console.log(e)},s=function(t){console.error("[Moon] ERR: "+t)},u=function(t){var e={};if(!t.attributes)return e;for(var n=t.attributes,r=0;r<n.length;r++)e[n[r].name]=n[r].value;return e},c=function(){return{shouldRender:!0,eventListeners:{}}},a=function(t,e,n){var r=/{{([A-Za-z0-9_.()\[\]]+)}}/gi,o=t;return t.replace(r,function(t,r){o=n?n(o,t,r):e?o.replace(t,'" + this.get("'+r+'") + "'):o.replace(t,'this.get("'+r+'")')}),o},h=function(t){return'h("'+t.type+'", '+JSON.stringify(t.props)+", "+JSON.stringify(t.meta)+", "+(t.children.join(",")||null)+")"},p=function(t,e,n,r,o){return{type:t,val:e,props:n,children:r,meta:o||c()}},f=function(){for(var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift()||{},r=t.shift(),o=[],i=0;i<t.length;i++){var s=t[i];Array.isArray(s)?o=o.concat(s):"string"==typeof t[i]||null===t[i]?o.push(p("#text",t[i]||"",{},[],r)):o.push(s)}return p(e,o.join(""),n,o,r)},l=function(t){var e;if("#text"===t.type)e=document.createTextNode(t.val);else{e=document.createElement(t.type);for(var n=t.children.map(l),r=0;r<n.length;r++)e.appendChild(n[r])}return e},d=function(t,r,o,i){var s=y(r,o);for(var u in s)!o[u]||e[u]||n[u]?(e[u]&&e[u](t,s[u],i),t.removeAttribute(u)):r[u]&&r[u]===o[u]||t.setAttribute(u,o[u])},v=function(t,e,n){var r;if(t&&(r=t.nodeName.toLowerCase()),!e||!e.meta||e.meta.shouldRender)if(t)if(e){if(r!==e.type)n.replaceChild(l(e),t);else if("#text"===r&&"#text"===e.type)t.textContent=e.val;else if(e.type){var o=u(t);d(t,o,e.props,e);for(var i=0;i<e.children.length||i<t.childNodes.length;i++)v(t.childNodes[i],e.children[i],t)}}else n.removeChild(t);else n.appendChild(l(e))},y=function(t,e){var n=Object.create(t);for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},$=function(){},m=function(t,e){var n={input:t,current:0,tokens:[]};return g(n),n.tokens},g=function(t){for(var e=t.input,n=e.length;t.current<n;)"<"===e.charAt(t.current)?"<!--"!==e.substr(t.current,4)?b(t):x(t):k(t)},k=function(t){var e=t.input,n=e.length,r=e.indexOf("<",t.current);return r===-1?(t.tokens.push({type:"text",value:e.slice(t.current)}),void(t.current=n)):void(r!==t.current&&(t.tokens.push({type:"text",value:e.slice(t.current,r)}),t.current=r))},x=function(t){var e=t.input,n=e.length;t.current+=4;var r=e.indexOf("-->",t.current);return r===-1?(t.tokens.push({type:"comment",value:e.slice(t.current)}),void(t.current=n)):(t.tokens.push({type:"comment",value:e.slice(t.current,r)}),void(t.current=r+3))},b=function(t){var e=t.input,n=(e.length,"/"===e.charAt(t.current+1));e.charAt(t.currrent);t.tokens.push({type:"tagStart",close:n}),t.current+=n?2:1;var r=A(t);O(t);var o="/"===e.charAt(t.current);t.tokens.push({type:"tagEnd",close:!1}),t.current+=o?2:1,o&&(t.tokens.push({type:"tagStart",close:!0}),t.tokens.push({type:"tag",value:r}),t.tokens.push({type:"attribute",value:{}}),t.tokens.push({type:"tagEnd",close:!1}))},A=function(t){for(var e=t.input,n=e.length,r=t.current;r<n;){var o=e.charAt(r);if("/"!==o&&">"!==o&&" "!==o)break;r++}for(var i=r;i<n;){var o=e.charAt(i);if("/"===o||">"===o||" "===o)break;i++}var s=e.slice(r,i);return t.tokens.push({type:"tag",value:s}),t.current=i,s},O=function(t){for(var e=t.input,n=e.length,r=t.current,o={},i="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var u=e.charAt(r);if(">"===u||"/"===u)break;i+=u,r++}i.replace(s,function(t,e,n,r){var i=r[0],s=r[r.length-1];("'"===i&&"'"===s||'"'===i&&'"'===s)&&(r=r.slice(1,-1)),r||(r=e),e&&r&&(o[e]=r)}),t.current=r,t.tokens.push({type:"attribute",value:o})},L=function(t){for(var e={type:"ROOT",children:[]},n={current:0,tokens:t};n.current<t.length;){var r=E(n);r&&e.children.push(r)}return e},C=function(t,e,n){return{type:t,props:e,children:n}},E=function(t){var e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2],i=t.tokens[t.current+3],s=function(i){t.current+=void 0===i?1:i,e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2]};if("text"===e.type)return s(),n.value;if("comment"===e.type)return void s();if("tagStart"===e.type&&!e.close&&!i.close){var u=C(r.value,o.value,[]);r.value;s(4);var c=t.current;if(e){for(;"tagStart"!==e.type||"tagStart"===e.type&&!e.close;){var a=E(t);if(a&&u.children.push(a),s(0),!e){t.current=c-1;break}}s()}return u}s()},R=function(t){var e="";if("string"==typeof t)e+='"'+t+'"';else{t.children=t.children.map(R),t.meta||(t.meta=c());var r=h(t);for(var o in t.props)n[o]&&(r=n[o](t.props[o],r,t));e+=r}return e},S=function(t){var e=/\n/g,n=t.children[0],r="return "+R(n);r=a(r,!0),r=r.replace(e,'" + "\\n" + "');try{return new Function("h",r)}catch(t){return s("Could not create render function"),$}},j=function(t){var e=m(t),n=L(e);return S(n)};return t.prototype.get=function(t){return this.$data[t]},t.prototype.set=function(t,e){var n=this;this.$data[t]=e,this.$queued||this.$destroyed||(this.$queued=!0,setTimeout(function(){n.build(),n.$hooks.updated(),n.$queued=!1},0))},t.prototype.destroy=function(){Object.defineProperty(this,"$data",{set:function(t){_data=t}}),this.removeEvents(),this.$destroyed=!0,this.$hooks.destroyed()},t.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},t.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},t.prototype.off=function(t,e){var n=this.$events[t].indexOf(e);n!==-1&&this.$events[t].splice(n,1)},t.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},t.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(e)}for(var n=0;n<this.$events[t].length;n++){var o=this.$events[t][n];o(e)}},t.prototype.renderLoop=function(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r]));return n},t.prototype.mount=function(e){this.$el=document.querySelector(e),this.$destroyed=!1,this.$el||s("Element "+this.$opts.el+" not found"),this.$template=this.$opts.template||this.$el.outerHTML,this.$render===$&&(this.$render=t.compile(this.$template)),this.build(),this.$hooks.mounted()},t.prototype.render=function(){return this.$render(f)},t.prototype.patch=function(t,e,n){v(t,e,n)},t.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom,this.$el.parentNode)},t.prototype.init=function(){i("======= Moon ======="),this.$hooks.created(),this.$opts.el&&this.mount(this.$opts.el)},t.config={silent:!1,prefix:"m-"},t.version="0.1.3",t.util={noop:$,error:s,log:i},t.use=function(e){e.init(t)},t.compile=function(t){return j(t)},t.nextTick=function(t){setTimeout(t,0)},t.directive=function(n,r){e[t.config.prefix+n]=r},t.component=function(e,n){function o(){t.call(this,n)}var i=this;o.prototype=Object.create(i.prototype),o.prototype.constructor=o;var s=new o;return r[e]=s,s},t});