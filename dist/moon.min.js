/*
* Moon v0.4.4
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){"use strict";function t(t){this.instance=t}function e(e){this.$opts=e||{},this.$id=s++,this.$name=this.$opts.name||"root",this.$parent=this.$opts.parent||null,this.$data=this.$opts.data||{},u(this,this.$data),this.$render=this.$opts.render||j,this.$hooks=this.$opts.hooks||{},this.$methods=this.$opts.methods||{},this.$events={},this.$dom={},this.$observer=new t(this),this.$destroyed=!1,this.$initialRender=!0,this.$queued=!1,this.init()}var n={},r={},o={},i={stop:"event.stopPropagation();",prevent:"event.preventDefault();",ctrl:"if(!event.ctrlKey) {return;};",shift:"if(!event.shiftKey) {return;};",alt:"if(!event.altKey) {return;};",enter:"if(event.keyCode !== 13) {return;};"},s=0,u=function(t,e){for(var n in e)a(t,e,n,e[n]);return e},a=function(t,e,n,r){null!==r&&"object"==typeof r&&u(t,r),Object.defineProperty(e,n,{get:function(){return r},set:function(e){r=e,t.$observer.notify()}})};t.prototype.notify=function(){f(this.instance)};var c=function(t){e.config.silent||console.log(t)},p=function(t){console.error("[Moon] ERR: "+t)},f=function(t){t.$queued||t.$destroyed||(t.$queued=!0,setTimeout(function(){t.build(),G(t,"updated"),t.$queued=!1},0))},l=function(t){for(var e={},n=t.attributes,r=n.length;r--;)e[n[r].name]=n[r].value;return t.__moon__attrs__=e,e},h=function(){return{shouldRender:!0,component:!1,eventListeners:{}}},v=function(t){var e=/\n/g,n=/"/g;return t.replace(e,"\\n").replace(n,'\\"')},d=function(t,e,n){var r,o=e.split(".");for(r=0;r<o.length-1;r++){var i=o[r];t=t[i]}return t[o[r]]=n,t},m=function(t,e){var n=/{{([A-Za-z0-9_]+)([A-Za-z0-9_.()'"+\-*\/\s\[\]]+)?}}/gi,r=t;return t.replace(n,function(t,n,o){o||(o=""),r=e?r.replace(t,'" + instance.get("'+n+'")'+o+' + "'):r.replace(t,'instance.get("'+n+'")'+o)}),r},y=function(t){var e={};if(!t)return e;var n="default";e[n]=[];for(var r=0;r<t.length;r++){var o=t[r];o.props.slot?(e[o.props.slot]?e[o.props.slot].push(o):e[o.props.slot]=[o],delete o.props.slot):e[n].push(o)}return e},g=function(t,e,n,r,o){return{type:t,val:e,props:n,children:r,meta:o||h()}},$=function(t,e,n,r,o){if(o.opts.functional)return b(t,e,n,r,o)},b=function(t,e,n,r,o){var i=o.opts.data||{};if(o.opts.props)for(var s=0;s<o.opts.props.length;s++){var u=o.opts.props[s];i[u]=e[u]}return o.opts.render(x,{data:i,slots:y(r)})},k=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?e=e.concat(k(r)):"string"==typeof r||null===r?e.push(g("#text",r||"",{},[],h())):e.push(r)}return e},x=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift()||{},r=t.shift(),i=k(t);return o[e]?$(e,n,r,i,o[e]):g(e,i.join(""),n,i,r)},A=function(t,e,n){var r=e.meta.eventListeners;for(var o in r)for(var i=0;i<r[o].length;i++){var s=r[o][i];t.addEventListener(o,s)}},L=function(t,e){var n;if("#text"===t.type)n=document.createTextNode(t.val);else{n=document.createElement(t.type);for(var r=0;r<t.children.length;r++)n.appendChild(L(t.children[r],e));A(n,t,e)}return C(n,{},t,t.props),n},C=function(t,e,o,i){var s=O(e,i);for(var u in s)!i[u]||n[u]||r[u]?(n[u]&&n[u](t,s[u],o),t.removeAttribute(u)):e[u]&&e[u]===i[u]||t.setAttribute(u,i[u])},R=function(t,e,n,r){var o;if(t&&(o=t.nodeName.toLowerCase()),!t&&e&&e.meta.shouldRender){var i=L(e,r);return n.appendChild(i),i}if(!e)return n.removeChild(t),null;if(o!==e.type){var i=L(e,r);return n.replaceChild(i,t),i}if("#text"===e.type&&"#text"===o)return t.textContent=e.val,t;if(e&&e.meta.shouldRender){var s=l(t);C(t,s,e,e.props),r.$initialRender&&A(t,e,r);for(var u=t.firstChild,a=0;a<e.children.length||u;a++){var c=u?u.nextSibling:null,i=R(u,e.children[a],t,r);u=c}}},_=function(t,e){for(var n in e)t[n]=e[n];return t},O=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},G=function(t,e){var n=t.$hooks[e];n&&n()},j=function(){},E=function(t){var e={input:t,current:0,tokens:[]};return S(e),e.tokens},S=function(t){for(var e=t.input,n=e.length;t.current<n;)"<"===e.charAt(t.current)?"<!--"!==e.substr(t.current,4)?q(t):T(t):w(t)},w=function(t){var e=t.input,n=e.length,r=e.indexOf("<",t.current);return r===-1?(t.tokens.push({type:"text",value:e.slice(t.current)}),void(t.current=n)):void(r!==t.current&&(t.tokens.push({type:"text",value:e.slice(t.current,r)}),t.current=r))},T=function(t){var e=t.input,n=e.length;t.current+=4;var r=e.indexOf("-->",t.current);return r===-1?(t.tokens.push({type:"comment",value:e.slice(t.current)}),void(t.current=n)):(t.tokens.push({type:"comment",value:e.slice(t.current,r)}),void(t.current=r+3))},q=function(t){var e=t.input,n=(e.length,"/"===e.charAt(t.current+1));t.tokens.push({type:"tagStart",close:n}),t.current+=n?2:1;var r=M(t);N(t);var o="/"===e.charAt(t.current);t.tokens.push({type:"tagEnd",close:!1}),t.current+=o?2:1,o&&(t.tokens.push({type:"tagStart",close:!0}),t.tokens.push({type:"tag",value:r}),t.tokens.push({type:"attribute",value:{}}),t.tokens.push({type:"tagEnd",close:!1}))},M=function(t){for(var e=t.input,n=e.length,r=t.current;r<n;){var o=e.charAt(r);if("/"!==o&&">"!==o&&" "!==o)break;r++}for(var i=r;i<n;){var o=e.charAt(i);if("/"===o||">"===o||" "===o)break;i++}var s=e.slice(r,i);return t.tokens.push({type:"tag",value:s}),t.current=i,s},N=function(t){for(var e=t.input,n=e.length,r=t.current,o={},i="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var u=e.charAt(r),a=e.charAt(r+1);if(">"===u||"/"===u&&">"===a)break;i+=u,r++}i.replace(s,function(t,e,n,r){var i=r[0],s=r[r.length-1];("'"===i&&"'"===s||'"'===i&&'"'===s)&&(r=r.slice(1,-1)),r||(r=e),e&&r&&(o[e]=r)}),t.current=r,t.tokens.push({type:"attribute",value:o})},K=function(t){for(var e={type:"ROOT",children:[]},n={current:0,tokens:t};n.current<t.length;){var r=P(n);r&&e.children.push(r)}return e},z={html:!0,body:!0,head:!0,style:!0,title:!0,address:!0,article:!0,aside:!0,footer:!0,header:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,hgroup:!0,nav:!0,section:!0,div:!0,dd:!0,dl:!0,dt:!0,figcaption:!0,figure:!0,li:!0,main:!0,ol:!0,p:!0,pre:!0,ul:!0,a:!0,b:!0,abbr:!0,bdi:!0,bdo:!0,cite:!0,code:!0,data:!0,dfn:!0,em:!0,i:!0,kbd:!0,mark:!0,q:!0,rp:!0,rt:!0,rtc:!0,ruby:!0,s:!0,samp:!0,small:!0,span:!0,strong:!0,sub:!0,sup:!0,time:!0,u:!0,var:!0,audio:!0,map:!0,video:!0,object:!0,canvas:!0,script:!0,noscript:!0,del:!0,ins:!0,caption:!0,colgroup:!0,table:!0,thead:!0,tbody:!0,td:!0,th:!0,tr:!0,button:!0,datalist:!0,fieldset:!0,form:!0,label:!0,legend:!0,meter:!0,optgroup:!0,option:!0,output:!0,progress:!0,select:!0,textarea:!0,details:!0,dialog:!0,menu:!0,menuitem:!0,summary:!0,content:!0,element:!0,shadow:!0,template:!0},F=function(t,e,n){return{type:t,props:e,children:n}},P=function(t){var e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2],i=t.tokens[t.current+3],s=function(i){t.current+=void 0===i?1:i,e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],o=t.tokens[t.current+2]};if("text"===e.type)return s(),n.value;if("comment"===e.type)return void s();if("tagStart"===e.type&&!e.close&&!i.close){var u=F(r.value,o.value,[]);r.value;s(4);t.current;if(e){if(!z[u.type])return u;for(;"tagStart"!==e.type||"tagStart"===e.type&&!e.close;){var a=P(t);if(a&&u.children.push(a),s(0),!e)break}s()}return u}s()},Z=function(t){var e=t.props;if(0===Object.keys(e).length)return"{}";var n="{";for(var o in e)r[o]&&r[o].beforeGenerate&&r[o].beforeGenerate(e[o],t),n+='"'+o+'": '+m(JSON.stringify(e[o]),!0)+", ";return n=n.slice(0,-2)+"}"},D=function(t){if(0===Object.keys(t).length)return"{}";var e="{";for(var n in t)e+='"'+n+'": ['+J(t[n])+"], ";return e=e.slice(0,-2)+"}"},H=function(t){var e="{";for(var n in t)e+="eventListeners"===n?'"'+n+'": '+D(t[n])+", ":'"'+n+'": '+t[n]+", ";return e=e.slice(0,-2)+"}"},J=function(t){for(var e="",n=0;n<t.length;n++)e+=t[n]+", ";return e=e.slice(0,-2)},B=function(t,e){var n='h("'+t.type+'", ';return n+=Z(t)+", ",n+=H(t.meta)+", ",n+=e.length?J(e):'""',n+=")"},I=function(t){var e="";if("string"==typeof t)e+='"'+m(v(t),!0)+'"';else{var n=t.children.map(I);t.meta||(t.meta=h());var o=B(t,n);for(var i in t.props)r[i]&&r[i].afterGenerate&&(o=r[i].afterGenerate(t.props[i],o,t));e+=o}return e},Q=function(t){var e=t.children[0],n="var instance = this; return "+I(e);try{return new Function("h",n)}catch(t){return p("Could not create render function"),j}},U=function(t){var e=E(t),n=K(e);return Q(n)};return e.prototype.get=function(t){return this.$data[t]},e.prototype.set=function(t,e){d(this.$data,t,e)},e.prototype.destroy=function(){this.removeEvents(),this.$destroyed=!0,G(this,"destroyed")},e.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},e.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},e.prototype.off=function(t,e){var n=this.$events[t].indexOf(e);n!==-1&&this.$events[t].splice(n,1)},e.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},e.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(e)}for(var n=0;n<this.$events[t].length;n++){var o=this.$events[t][n];o(e)}},e.prototype.renderLoop=function(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n},e.prototype.mount=function(t){this.$el=document.querySelector(t),this.$destroyed=!1,this.$el||p("Element "+this.$opts.el+" not found"),this.$el.__moon__=this,this.$template=this.$opts.template||this.$el.outerHTML,this.$render===j&&(this.$render=e.compile(this.$template)),this.build(),G(this,"mounted")},e.prototype.render=function(){return this.$render(x)},e.prototype.patch=function(t,e,n){R(t,e,n,this),this.$initialRender=!1},e.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom,this.$el.parentNode)},e.prototype.init=function(){c("======= Moon ======="),G(this,"init"),this.$opts.el&&this.mount(this.$opts.el)},e.config={silent:"undefined"==typeof console,prefix:"m-",keyCodes:function(t){for(var e in t)i[e]="if(event.keyCode !== "+t[e]+") {return;};"}},e.version="0.4.4",e.util={noop:j,error:p,log:c,merge:O,extend:_},e.use=function(t){t.init(e)},e.compile=function(t){return U(t)},e.nextTick=function(t){setTimeout(t,0)},e.directive=function(t,r){n[e.config.prefix+t]=r},e.component=function(t,n){function r(){e.call(this,n)}var i=this;return n.name=t,n.parent=i,r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.init=function(){G(this,"init"),this.$destroyed=!1,this.$props=this.$opts.props||[],this.$template=this.$opts.template,this.$render===j&&(this.$render=e.compile(this.$template))},o[t]={CTor:r,opts:n},r},r[e.config.prefix+"if"]={afterGenerate:function(t,e,n){return"("+m(t,!1)+") ? "+e+" : ''"}},r[e.config.prefix+"for"]={afterGenerate:function(t,e,n){var r=t.split(" in "),o=r[0].split(","),i='instance.get("'+r[1]+'")',s=o.join(",");return e.replace(/instance\.get\("([^"]+)"\)/g,function(t,n){o.indexOf(n)!==-1&&(e=e.replace(new RegExp('instance.get\\("'+n+'"\\)',"g"),n))}),"instance.renderLoop("+i+", function("+s+") { return "+e+"; })"}},r[e.config.prefix+"on"]={beforeGenerate:function(t,e){t=m(t,!1);var n=t.split(":"),r=n[0].split("."),o=r[0],s=n[1],u="(event)",a=s.split("(")[1];a&&(u="");var c="";r.shift();for(var p=0;p<r.length;p++)c+=i[r[p]];var f="function(event) {"+c+"instance.$methods."+s+u+"}";e.meta.eventListeners[o]?e.meta.eventListeners[o].push(f):e.meta.eventListeners[o]=[f]}},r[e.config.prefix+"model"]={beforeGenerate:function(t,e){var n='function(event) {instance.set("'+t+'", event.target.value)}';e.meta.eventListeners.input?e.meta.eventListeners.input.push(n):e.meta.eventListeners.input=[n]}},r[e.config.prefix+"once"]={beforeGenerate:function(t,e){e.meta.shouldRender="instance.$initialRender"}},r[e.config.prefix+"pre"]={beforeGenerate:function(t,e){e.meta.shouldRender=!1}},n[e.config.prefix+"show"]=function(t,e,n){var r=new Function("return "+e);r()?t.style.display="block":t.style.display="none"},n[e.config.prefix+"text"]=function(t,e,n){t.textContent=e,n.children[0].val=e},n[e.config.prefix+"mask"]=function(t,e,n){},e});