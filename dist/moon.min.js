/*
* Moon v0.4.3
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.Moon=e()}(this,function(){"use strict";function t(t){this.$opts=t||{},this.$id=o++,this.$name=this.$opts.name||"root",this.$parent=this.$opts.parent||null,this.$data=this.$opts.data||{},this.$render=this.$opts.render||R,this.$hooks=this.$opts.hooks||{},this.$methods=this.$opts.methods||{},this.$events={},this.$dom={},this.$destroyed=!1,this.$initialRender=!0,this.$queued=!1,this.init()}var e={},n={},r={},i={stop:"event.stopPropagation();",prevent:"event.preventDefault();",ctrl:"if(!event.ctrlKey) {return;};",shift:"if(!event.shiftKey) {return;};",alt:"if(!event.altKey) {return;};",enter:"if(event.keyCode !== 13) {return;};"},o=0,s=function(e){t.config.silent||console.log(e)},u=function(t){console.error("[Moon] ERR: "+t)},a=function(t){for(var e={},n=t.attributes,r=n.length;r--;)e[n[r].name]=n[r].value;return t.__moon__attrs__=e,e},c=function(){return{shouldRender:!0,component:!1,eventListeners:{}}},p=function(t){var e=/\n/g,n=/"/g;return t.replace(e,"\\n").replace(n,'\\"')},f=function(t,e,n){var r,i=e.split(".");for(r=0;r<i.length-1;r++){var o=i[r];t=t[o]}return t[i[r]]=n,t},l=function(t,e){var n=/{{([A-Za-z0-9_]+)([A-Za-z0-9_.()'"+\-*\/\s\[\]]+)?}}/gi,r=t;return t.replace(n,function(t,n,i){i||(i=""),r=e?r.replace(t,'" + instance.get("'+n+'")'+i+' + "'):r.replace(t,'instance.get("'+n+'")'+i)}),r},h=function(t){var e={};if(!t)return e;var n="default";e[n]=[];for(var r=0;r<t.length;r++){var i=t[r];i.props.slot?(e[i.props.slot]?e[i.props.slot].push(i):e[i.props.slot]=[i],delete i.props.slot):e[n].push(i)}return e},v=function(t,e,n,r,i){return{type:t,val:e,props:n,children:r,meta:i||c()}},d=function(t,e,n,r,i){if(i.opts.functional)return m(t,e,n,r,i)},m=function(t,e,n,r,i){var o=i.opts.data||{};if(i.opts.props)for(var s=0;s<i.opts.props.length;s++){var u=i.opts.props[s];o[u]=e[u]}return i.opts.render(y,{data:o,slots:h(r)})},g=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?e=e.concat(g(r)):"string"==typeof r||null===r?e.push(v("#text",r||"",{},[],c())):e.push(r)}return e},y=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift()||{},i=t.shift(),o=g(t);return r[e]?d(e,n,i,o,r[e]):v(e,o.join(""),n,o,i)},$=function(t,e,n){var r=e.meta.eventListeners;for(var i in r)for(var o=0;o<r[i].length;o++){var s=r[i][o];t.addEventListener(i,s)}},b=function(t,e){var n;if("#text"===t.type)n=document.createTextNode(t.val);else{n=document.createElement(t.type);for(var r=0;r<t.children.length;r++)n.appendChild(b(t.children[r],e));$(n,t,e)}return k(n,{},t.props,t),n},k=function(t,r,i,o){var s=A(r,i);for(var u in s)!i[u]||e[u]||n[u]?(e[u]&&e[u](t,s[u],o),t.removeAttribute(u)):r[u]&&r[u]===i[u]||t.setAttribute(u,i[u])},x=function(e,n,r,i){var o;if(e&&(o=e.nodeName.toLowerCase()),n&&n.meta.shouldRender||!n)if(e)if(n){if(o!==n.type){var s=b(n,i);return r.replaceChild(s,e),s}if("#text"===o&&"#text"===n.type)e.textContent=n.val;else if(n.type){var u=e.__moon__attrs__||a(e);k(e,u,n.props,n),i.$initialRender&&$(e,n,i);var c=e.firstChild;if(1===n.children.length&&c&&!c.nextSibling&&"#text"===c.nodeName&&"#text"===n.children[0].type)e.firstChild.textContent=n.children[0].val;else for(var p=0;p<n.children.length||c;p++){var f=x(c,n.children[p],e,i);f&&(c=f),c=c?c.nextSibling:null}}}else r.removeChild(e);else r.appendChild(b(n,i));else n&&!n.meta.shouldRender&&n.props[t.config.prefix+"pre"]&&e.removeAttribute(t.config.prefix+"pre")},_=function(t,e){for(var n in e)t[n]=e[n];return t},A=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},C=function(t){for(var e={},n=0;n<t.length;n++)e[t[n]]=!0;return function(t){return e[t]}},L=function(t,e){var n=t.$hooks[e];n&&n()},R=function(){},G=function(t){var e={input:t,current:0,tokens:[]};return O(e),e.tokens},O=function(t){for(var e=t.input,n=e.length;t.current<n;)"<"===e.charAt(t.current)?"<!--"!==e.substr(t.current,4)?T(t):S(t):E(t)},E=function(t){var e=t.input,n=e.length,r=e.indexOf("<",t.current);return r===-1?(t.tokens.push({type:"text",value:e.slice(t.current)}),void(t.current=n)):void(r!==t.current&&(t.tokens.push({type:"text",value:e.slice(t.current,r)}),t.current=r))},S=function(t){var e=t.input,n=e.length;t.current+=4;var r=e.indexOf("-->",t.current);return r===-1?(t.tokens.push({type:"comment",value:e.slice(t.current)}),void(t.current=n)):(t.tokens.push({type:"comment",value:e.slice(t.current,r)}),void(t.current=r+3))},T=function(t){var e=t.input,n=(e.length,"/"===e.charAt(t.current+1));t.tokens.push({type:"tagStart",close:n}),t.current+=n?2:1;var r=j(t);q(t);var i="/"===e.charAt(t.current);t.tokens.push({type:"tagEnd",close:!1}),t.current+=i?2:1,i&&(t.tokens.push({type:"tagStart",close:!0}),t.tokens.push({type:"tag",value:r}),t.tokens.push({type:"attribute",value:{}}),t.tokens.push({type:"tagEnd",close:!1}))},j=function(t){for(var e=t.input,n=e.length,r=t.current;r<n;){var i=e.charAt(r);if("/"!==i&&">"!==i&&" "!==i)break;r++}for(var o=r;o<n;){var i=e.charAt(o);if("/"===i||">"===i||" "===i)break;o++}var s=e.slice(r,o);return t.tokens.push({type:"tag",value:s}),t.current=o,s},q=function(t){for(var e=t.input,n=e.length,r=t.current,i={},o="",s=/([^=\s]*)(=?)("[^"]*"|[^\s"]*)/gi;r<n;){var u=e.charAt(r),a=e.charAt(r+1);if(">"===u||"/"===u&&">"===a)break;o+=u,r++}o.replace(s,function(t,e,n,r){var o=r[0],s=r[r.length-1];("'"===o&&"'"===s||'"'===o&&'"'===s)&&(r=r.slice(1,-1)),r||(r=e),e&&r&&(i[e]=r)}),t.current=r,t.tokens.push({type:"attribute",value:i})},w=function(t){for(var e={type:"ROOT",children:[]},n={current:0,tokens:t};n.current<t.length;){var r=K(n);r&&e.children.push(r)}return e},M=C(["html","body","head","style","title","address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","nav","section","div","dd","dl","dt","figcaption","figure","li","main","ol","p","pre","ul","a","b","abbr","bdi","bdo","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","audio","map","video","object","canvas","script","noscript","del","ins","caption","colgroup","table","thead","tbody","td","th","tr","button","datalist","fieldset","form","label","legend","meter","optgroup","option","output","progress","select","textarea","details","dialog","menu","menuitem","summary","content","element","shadow","template"]),N=function(t,e,n){return{type:t,props:e,children:n}},K=function(t){var e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],i=t.tokens[t.current+2],o=t.tokens[t.current+3],s=function(o){t.current+=void 0===o?1:o,e=t.tokens[t.current],n=t.tokens[t.current-1],r=t.tokens[t.current+1],i=t.tokens[t.current+2]};if("text"===e.type)return s(),n.value;if("comment"===e.type)return void s();if("tagStart"===e.type&&!e.close&&!o.close){var u=N(r.value,i.value,[]);r.value;s(4);t.current;if(e){if(!M(u.type))return u;for(;"tagStart"!==e.type||"tagStart"===e.type&&!e.close;){var a=K(t);if(a&&u.children.push(a),s(0),!e)break}s()}return u}s()},z=function(t){var e=t.props;if(0===Object.keys(e).length)return"{}";var r="{";for(var i in e)n[i]&&n[i].beforeGenerate&&n[i].beforeGenerate(e[i],t),r+='"'+i+'": '+l(JSON.stringify(e[i]),!0)+", ";return r=r.slice(0,-2)+"}"},F=function(t){if(0===Object.keys(t).length)return"{}";var e="{";for(var n in t)e+='"'+n+'": ['+Z(t[n])+"], ";return e=e.slice(0,-2)+"}"},H=function(t){var e="{";for(var n in t)e+="eventListeners"===n?'"'+n+'": '+F(t[n])+", ":'"'+n+'": '+t[n]+", ";return e=e.slice(0,-2)+"}"},Z=function(t){for(var e="",n=0;n<t.length;n++)e+=t[n]+", ";return e=e.slice(0,-2)},D=function(t,e){var n='h("'+t.type+'", ';return n+=z(t)+", ",n+=H(t.meta)+", ",n+=e.length?Z(e):'""',n+=")"},J=function(t){var e="";if("string"==typeof t)e+='"'+l(p(t),!0)+'"';else{var r=t.children.map(J);t.meta||(t.meta=c());var i=D(t,r);for(var o in t.props)n[o]&&n[o].afterGenerate&&(i=n[o].afterGenerate(t.props[o],i,t));e+=i}return e},P=function(t){var e=t.children[0],n="var instance = this; return "+J(e);try{return new Function("h",n)}catch(t){return u("Could not create render function"),R}},B=function(t){var e=G(t),n=w(e);return P(n)};return t.prototype.get=function(t){return this.$data[t]},t.prototype.set=function(t,e){var n=this;f(this.$data,t,e),this.$queued||this.$destroyed||(this.$queued=!0,setTimeout(function(){n.build(),L(n,"updated"),n.$queued=!1},0))},t.prototype.destroy=function(){this.removeEvents(),this.$destroyed=!0,L(this,"destroyed")},t.prototype.callMethod=function(t,e){e=e||[],this.$methods[t].apply(this,e)},t.prototype.on=function(t,e){this.$events[t]?this.$events[t].push(e):this.$events[t]=[e]},t.prototype.off=function(t,e){var n=this.$events[t].indexOf(e);n!==-1&&this.$events[t].splice(n,1)},t.prototype.removeEvents=function(){for(var t in this.$events)this.$events[t]=[]},t.prototype.emit=function(t,e){if(e=e||{},e.type=t,this.$events["*"])for(var n=0;n<this.$events["*"].length;n++){var r=this.$events["*"][n];r(e)}for(var n=0;n<this.$events[t].length;n++){var i=this.$events[t][n];i(e)}},t.prototype.renderLoop=function(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n},t.prototype.mount=function(e){this.$el=document.querySelector(e),this.$destroyed=!1,this.$el||u("Element "+this.$opts.el+" not found"),this.$el.__moon__=this,this.$template=this.$opts.template||this.$el.outerHTML,this.$render===R&&(this.$render=t.compile(this.$template)),this.build(),L(this,"mounted")},t.prototype.render=function(){return this.$render(y)},t.prototype.patch=function(t,e,n){x(t,e,n,this),this.$initialRender=!1},t.prototype.build=function(){this.$dom=this.render(),this.patch(this.$el,this.$dom,this.$el.parentNode)},t.prototype.init=function(){s("======= Moon ======="),L(this,"init"),this.$opts.el&&this.mount(this.$opts.el)},t.config={silent:"undefined"==typeof console,prefix:"m-",keyCodes:function(t){for(var e in t)i[e]="if(event.keyCode !== "+t[e]+") {return;};"}},t.version="0.4.3",t.util={noop:R,error:u,log:s,merge:A,extend:_},t.use=function(e){e.init(t)},t.compile=function(t){return B(t)},t.nextTick=function(t){setTimeout(t,0)},t.directive=function(n,r){e[t.config.prefix+n]=r},t.component=function(e,n){function i(){t.call(this,n)}var o=this;return n.name=e,n.parent=o,i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.init=function(){L(this,"init"),this.$destroyed=!1,this.$props=this.$opts.props||[],this.$template=this.$opts.template,this.$render===R&&(this.$render=t.compile(this.$template))},r[e]={CTor:i,opts:n},i},n[t.config.prefix+"if"]={afterGenerate:function(t,e,n){return"("+l(t,!1)+") ? "+e+" : ''"}},n[t.config.prefix+"for"]={afterGenerate:function(t,e,n){var r=t.split(" in "),i=r[0].split(","),o='instance.get("'+r[1]+'")',s=i.join(",");return e.replace(/instance\.get\("([^"]+)"\)/g,function(t,n){i.indexOf(n)!==-1&&(e=e.replace(new RegExp('instance.get\\("'+n+'"\\)',"g"),n))}),"instance.renderLoop("+o+", function("+s+") { return "+e+"; })"}},n[t.config.prefix+"on"]={beforeGenerate:function(t,e){t=l(t,!1);var n=t.split(":"),r=n[0].split("."),o=r[0],s=n[1],u="(event)",a=s.split("(")[1];a&&(u="");var c="";r.shift();for(var p=0;p<r.length;p++)c+=i[r[p]];var f="function(event) {"+c+"instance.$methods."+s+u+"}";e.meta.eventListeners[o]?e.meta.eventListeners[o].push(f):e.meta.eventListeners[o]=[f]}},n[t.config.prefix+"model"]={beforeGenerate:function(t,e){var n='function(event) {instance.set("'+t+'", event.target.value)}';e.meta.eventListeners.input?e.meta.eventListeners.input.push(n):e.meta.eventListeners.input=[n]}},n[t.config.prefix+"once"]={beforeGenerate:function(t,e){e.meta.shouldRender="instance.$initialRender"}},n[t.config.prefix+"pre"]={beforeGenerate:function(t,e){e.meta.shouldRender=!1}},e[t.config.prefix+"show"]=function(t,e,n){var r=new Function("return "+e);r()?t.style.display="block":t.style.display="none"},e[t.config.prefix+"text"]=function(t,e,n){t.textContent=e,n.children[0].val=e},e[t.config.prefix+"html"]=function(t,e,n){t.innerHTML=e;for(var r=0;r<n.children.length;r++)n.children[r].meta.shouldRender=!1},e[t.config.prefix+"mask"]=function(t,e,n){},t});